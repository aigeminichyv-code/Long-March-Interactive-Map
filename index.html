<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>äºŒè¬äº”åƒé‡Œé•·å¾ - äº¤äº’å¼æ•™å­¸åœ°åœ–</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* --- å…¨å±€ä¸»é¡Œï¼šç´…æ˜Ÿèˆ‡é»ƒåœŸ (Red Star & Aged Paper) --- */
      :root {
        --paper-bg: #fdfbf7;
        --ink-color: #2c2420;
        --red-primary: #b71c1c;
        --gold-accent: #ffd600;
      }
      
      body {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        color: var(--ink-color);
        background-color: #f5f0e1;
        overflow: hidden; /* é˜²æ­¢ body æ»¾å‹•ï¼Œä½¿ç”¨å…§éƒ¨å®¹å™¨ */
        margin: 0;
      }

      /* ä»¿å¤è¥¯ç·šé«” */
      h1, h2, h3, h4, .font-serif {
        font-family: "Songti SC", "SimSun", "Times New Roman", serif;
      }

      /* è‡ªå®šç¾©å‹•ç•« */
      @keyframes fadeInZoom {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
      }
      @keyframes slideUpFade {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in-zoom { animation: fadeInZoom 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
      .animate-slide-up { animation: slideUpFade 0.4s ease-out forwards; }

      /* æ»¾å‹•æ¢æ¨£å¼ */
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #e6e2d3; }
      ::-webkit-scrollbar-thumb { 
        background: #bcaaa4; 
        border-radius: 4px; 
        border: 2px solid #e6e2d3; 
      }
      ::-webkit-scrollbar-thumb:hover { background: #8d6e63; }

      .bg-paper {
        background-color: var(--paper-bg);
        background-image: url("https://www.transparenttextures.com/patterns/cream-dust.png");
      }
      
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react">
      const { useState, useEffect, useRef } = React;

      // --- 1. åœ–æ¨™çµ„ä»¶ (SVG Wrapper) ---
      // é€™è£¡åŒ…å«äº†æ‰€æœ‰ä½¿ç”¨åˆ°çš„ Lucide åœ–æ¨™çš„ SVG å®šç¾©
      const Icon = ({ children, size = 24, className = "", ...props }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
      );
      
      // Navigation & UI
      const ChevronRight = (p) => <Icon {...p}><path d="m9 18 6-6-6-6"/></Icon>;
      const ChevronLeft = (p) => <Icon {...p}><path d="m15 18-6-6 6-6"/></Icon>;
      const X = (p) => <Icon {...p}><path d="M18 6 6 18"/><path d="m6 6 18 18"/></Icon>;
      const ArrowRight = (p) => <Icon {...p}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></Icon>;
      const RefreshCw = (p) => <Icon {...p}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></Icon>;
      
      // Context & Meaning
      const MapPin = (p) => <Icon {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></Icon>;
      const BookOpen = (p) => <Icon {...p}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></Icon>;
      const HelpCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></Icon>;
      const Info = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;
      const Flag = (p) => <Icon {...p}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></Icon>;
      const Star = (p) => <Icon {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></Icon>;
      const Users = (p) => <Icon {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></Icon>;
      const Tent = (p) => <Icon {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2Z"/><path d="m2 21 20-18"/><path d="m22 21-20-18"/></Icon>;
      const Flame = (p) => <Icon {...p}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-2.072-2.143-3-3a6.5 6.5 0 1 0 12 0c-.928.857-1.928.857-3 3-.5 1-1 1.62-1 3a2.5 2.5 0 0 0 2.5 2.5"/></Icon>;
      const Scroll = (p) => <Icon {...p}><path d="M8 2h8a4 4 0 0 1 0 8h-1a2 2 0 0 0 0 4h1a4 4 0 0 1 0 8H8a2 2 0 0 1 0-4h1a2 2 0 0 0 0-4H8a2 2 0 0 1 0-4h1a2 2 0 0 0 0-4H8a2 2 0 0 1 0-8Z"/></Icon>;
      
      // Game & Quiz
      const Trophy = (p) => <Icon {...p}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></Icon>;
      const Medal = (p) => <Icon {...p}><path d="M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15"/><path d="M11 12 5.12 2.2"/><path d="m13 12 5.88-9.8"/><path d="M8 7h8"/><circle cx="12" cy="17" r="5"/><path d="M12 18v-2h-.5"/></Icon>;
      const ShieldCheck = (p) => <Icon {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></Icon>;
      const CheckCircle = (p) => <Icon {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m22 4-12 12-4-4"/></Icon>;
      const XCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></Icon>;
      const AlertTriangle = (p) => <Icon {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></Icon>;
      const Skull = (p) => <Icon {...p}><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></Icon>;
      
      // Survival Resources (Previously missing, causing crash)
      const Wheat = (p) => <Icon {...p}><path d="M2 22 16 8"/><path d="M3.47 12.53 5 11l1.53 1.53a3.5 3.5 0 0 1 0 4.94L2 22l4.53-4.53a3.5 3.5 0 0 1 4.94 0L13 19l-1.53 1.53"/><path d="M2 22 16 8"/><path d="M8.47 7.53 10 6l1.53 1.53a3.5 3.5 0 0 1 0 4.94L7 17l4.53-4.53a3.5 3.5 0 0 1 4.94 0L18 14l-1.53 1.53"/><path d="M20 4h2v2a4 4 0 0 1-4 4h-2V8a4 4 0 0 1 4-4Z"/></Icon>;
      const Heart = (p) => <Icon {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></Icon>;

      // Map Decorations
      const Mountain = (p) => <Icon {...p}><path d="m8 3 4 8 5-5 5 15H2L8 3z"/></Icon>;
      const Waves = (p) => <Icon {...p}><path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/></Icon>;

      // --- 2. æ•¸æ“šè³‡æ–™ (Constants) ---
      const MILESTONES = [
        {
          id: 0,
          title: "ç‘é‡‘å‡ºç™¼",
          date: "1934å¹´10æœˆ",
          location: "æ±Ÿè¥¿ç‘é‡‘",
          coords: { x: 72, y: 72 },
          description: "ç”±æ–¼ç¬¬äº”æ¬¡åã€Œåœå‰¿ã€å¤±æ•—ï¼Œä¸­å¤®ç´…è»ï¼ˆç´…ä¸€æ–¹é¢è»ï¼‰ä¸»åŠ›é–‹å§‹é€²è¡Œæˆ°ç•¥è½‰ç§»ã€‚é€™æ˜¯ä¸€æ¬¡è¢«é€¼ç„¡å¥ˆçš„æ’¤é€€ï¼ŒåˆæœŸæ”œå¸¶äº†å¤§é‡è¼œé‡ï¼ˆå£‡å£‡ç½ç½ï¼‰ï¼Œè¡Œè»é€Ÿåº¦æ¥µæ…¢ã€‚",
          significance: "ç´…è»è¢«è¿«æ’¤é›¢ä¸­å¤®è˜‡å€ï¼Œé–‹å§‹äº†è‰±è‹¦å“çµ•çš„æˆ°ç•¥å¤§è½‰ç§»ã€‚é€™æ˜¯é•·å¾çš„èµ·é»ã€‚",
          figures: [
            { name: "åšå¤", role: "ä¸­å…±ä¸­å¤®ç¸½è² è²¬äºº", desc: "æ¨è¡Œã€Œå·¦ã€å‚¾éŒ¯èª¤è·¯ç·šï¼Œå°è‡´ååœå‰¿å¤±æ•—ã€‚" },
            { name: "æå¾·", role: "å…±ç”¢åœ‹éš›è»äº‹é¡§å•", desc: "æŒæ¡è»äº‹æŒ‡æ®æ¬Šï¼Œæ¡å–æ©Ÿæ¢°çš„é™£åœ°æˆ°ã€‚" }
          ],
          survival: {
            title: "æ¬å®¶å¼è¡Œè»",
            content: "å‡ºç™¼åˆæœŸï¼Œç´…è»å¯¦è¡Œã€Œå¤§æ¬å®¶ã€ï¼Œæ”œå¸¶äº†å°åˆ·æ©Ÿã€Xå…‰æ©Ÿç”šè‡³æ¡Œæ¤…æ¿å‡³ã€‚é€™äº›ç¬¨é‡çš„è¼œé‡åš´é‡æ‹–æ…¢äº†è¡Œè»é€Ÿåº¦ï¼Œè®“ç´…è»åœ¨çªç ´å°é–ç·šæ™‚ä»˜å‡ºäº†æ¥µå¤§ä»£åƒ¹ã€‚"
          },
          stat: { label: "å‡ºç™¼äººæ•¸", value: "8.6è¬é¤˜äºº", icon: "users" },
          quizzes: [
            { question: "é•·å¾çš„å‡ºç™¼é»ä¸»è¦æ˜¯åœ¨å“ªå€‹çœä»½ï¼Ÿ", options: ["é™è¥¿", "æ±Ÿè¥¿", "è²´å·", "å››å·"], answer: 1, explanation: "ä¸­å¤®ç´…è»æ˜¯å¾æ±Ÿè¥¿ç‘é‡‘ï¼ˆä¸­å¤®è˜‡å€ï¼‰å‡ºç™¼çš„ã€‚" },
            { question: "å°è‡´ç´…è»è¢«è¿«é€²è¡Œæˆ°ç•¥è½‰ç§»ï¼ˆé•·å¾ï¼‰çš„ç›´æ¥åŸå› æ˜¯ï¼Ÿ", options: ["ç¬¬å››æ¬¡ååœå‰¿å¤±æ•—", "ç¬¬äº”æ¬¡ååœå‰¿å¤±æ•—", "åŒ—ä¸ŠæŠ—æ—¥", "æ“´å¤§æ ¹æ“šåœ°"], answer: 1, explanation: "ç¬¬äº”æ¬¡ååœå‰¿å¤±æ•—å¾Œï¼Œä¸­å¤®ç´…è»ç„¡æ³•åœ¨ä¸­å¤®è˜‡å€ç«‹è¶³ï¼Œè¢«è¿«è½‰ç§»ã€‚" },
            { question: "é•·å¾åˆæœŸï¼Œç´…è»è¡Œè»é€Ÿåº¦ç·©æ…¢çš„ä¸»è¦åŸå› æ˜¯ï¼Ÿ", options: ["æ”œå¸¶å¤§é‡è¼œé‡ï¼ˆå£‡å£‡ç½ç½ï¼‰", "é“è·¯è¢«ç ´å£", "ç­‰å¾…æ´è»", "å¤©æ°£æƒ¡åŠ£"], answer: 0, explanation: "ã€Œå¤§æ¬å®¶ã€å¼çš„è¡Œè»æ”œå¸¶äº†éå¤šç¬¨é‡ç‰©è³‡ï¼Œåš´é‡æ‹–ç´¯äº†éƒ¨éšŠé€Ÿåº¦ã€‚" }
          ],
          game: {
            scenario: "ã€æ­·å²æŠ‰æ“‡ã€‘å¤§æ’¤é€€é–‹å§‹ï¼Œå¾Œå‹¤éƒ¨å°‡é€ å¹£æ©Ÿã€Xå…‰æ©Ÿç”šè‡³ç¬¨é‡çš„æ¡Œæ¤…éƒ½æ‰“åŒ…å¸¶ä¸Šäº†ï¼ŒéšŠä¼è®Šæˆäº†ã€Œç”¬é“å¼ã€æ¬å®¶ï¼Œæ—¥è¡Œåƒ…å¹¾åé‡Œã€‚æ•µè»ç¢‰å ¡ç¾¤å°±åœ¨å‰æ–¹ï¼Œä½ ä½œç‚ºæŒ‡æ®å“¡å»ºè­°ï¼š",
            options: [
              { label: "å …æ±ºä¸Ÿæ£„é‡å‹è¼œé‡ï¼Œè¼•è£çªåœ", foodChange: -5, moraleChange: 10, result: "æ­·å²æ­£ç¢ºé¸æ“‡ï¼é›–ç„¶æå¤±äº†è¨­å‚™ï¼Œä½†éƒ¨éšŠæ©Ÿå‹•æ€§å¤§å¢ï¼Œæ¸›å°‘äº†çªç ´å°é–ç·šæ™‚çš„å‚·äº¡ã€‚" },
              { label: "å…¨æ•¸æ”œå¸¶ï¼Œé€™äº›æ˜¯é©å‘½çš„å®¶ç•¶", foodChange: -20, moraleChange: -15, result: "éŒ¯èª¤çš„ã€Œå¤§æ¬å®¶ã€ï¼éƒ¨éšŠè‡ƒè…«ä¸å ªï¼Œåœ¨æ¹˜æ±Ÿæˆ°å½¹ä¸­æˆç‚ºæ•µæ©Ÿè½Ÿç‚¸çš„æ´»é¶å­ï¼Œå‚·äº¡æ…˜é‡ã€‚" },
              { label: "å¾µç”¨æ°‘å¤«å”åŠ©æ¬é‹", foodChange: -15, moraleChange: -10, result: "å¢åŠ äº†ç³§é£Ÿæ¶ˆè€—ï¼Œä¸”æ°‘å¤«åœ¨æˆ°äº‚ä¸­å››æ•£é€ƒè·‘ï¼Œé€ æˆäº†æ›´å¤§çš„æ··äº‚ã€‚" },
              { label: "å°±åœ°æ©åŸ‹ï¼Œç•™ä¸‹æ¨™è¨˜å¾…æ—¥å¾Œå–å›", foodChange: -10, moraleChange: 0, result: "æŠ˜è¡·æ–¹æ¡ˆã€‚é›–ç„¶æ¸›è¼•äº†è² æ“”ï¼Œä½†æ©åŸ‹å·¥ä½œè€—è²»äº†å¯¶è²´çš„çªåœæ™‚é–“ã€‚" }
            ]
          }
        },
        {
          id: 1,
          title: "è¡€æˆ°æ¹˜æ±Ÿ",
          date: "1934å¹´11æœˆ",
          location: "å»£è¥¿å…¨å·",
          coords: { x: 65, y: 70 },
          description: "é•·å¾ä¸­æœ€æ…˜çƒˆçš„ä¸€æˆ°ã€‚ç´…è»çªç ´åœ‹æ°‘é»¨è»ç¬¬å››é“å°é–ç·šï¼Œä½†ç”±æ–¼éšŠä¼è‡ƒè…«å’ŒæŒ‡æ®å¤±èª¤ï¼Œä»˜å‡ºäº†æ¥µå…¶æ…˜é‡çš„ä»£åƒ¹ã€‚æ¹˜æ±Ÿæ°´è¢«ç´…è»æˆ°å£«çš„é®®è¡€æŸ“ç´…ã€‚",
          significance: "é›–ç„¶çªç ´äº†å°é–ï¼Œä½†æ…˜é‡çš„çŠ§ç‰²ï¼ˆæå…µæŠ˜å°‡éåŠï¼‰å¼•ç™¼äº†å»£å¤§æŒ‡æˆ°å“¡å°è»äº‹æŒ‡æ®éŒ¯èª¤çš„å¼·çƒˆä¸æ»¿ï¼Œç‚ºéµç¾©æœƒè­°çš„å¬é–‹åŸ‹ä¸‹ä¼ç­†ã€‚",
          figures: [
            { name: "é™³æ¨¹æ¹˜", role: "ç´…34å¸«å¸«é•·", desc: "ç‡é ˜å…¨å¸«æ“”ä»»å¾Œè¡›ï¼Œå½ˆç›¡ç³§çµ•å¾Œè…¹éƒ¨ä¸­å½ˆï¼Œæ–·è…¸æ˜å¿—ï¼Œå£¯çƒˆçŠ§ç‰²ã€‚" }
          ],
          survival: {
            title: "ä¸‰å¹´ä¸é£²æ¹˜æ±Ÿæ°´",
            content: "æˆ°å½¹éå¾Œï¼Œç•¶åœ°ç™¾å§“æµå‚³è‘—ã€Œä¸‰å¹´ä¸é£²æ¹˜æ±Ÿæ°´ï¼Œåå¹´ä¸é£Ÿæ¹˜æ±Ÿé­šã€çš„èªªæ³•ï¼Œå¯è¦‹æˆ°æ³ä¹‹æ…˜çƒˆï¼Œå±æ©«éé‡ã€‚"
          },
          stat: { label: "äººå“¡éŠ³æ¸›", value: "8.6è¬ â†’ 3è¬", icon: "users" },
          quizzes: [
            { question: "æ¹˜æ±Ÿæˆ°å½¹å¾Œï¼Œç´…è»äººæ•¸ç™¼ç”Ÿäº†ä»€éº¼è®ŠåŒ–ï¼Ÿ", options: ["å¢åŠ äº†ä¸€å€", "åŸºæœ¬æŒå¹³", "éŠ³æ¸›éåŠ", "å…¨éƒ¨çŠ§ç‰²"], answer: 2, explanation: "æ¹˜æ±Ÿæˆ°å½¹æ˜¯é•·å¾ä¸­æœ€æ…˜çƒˆçš„æˆ°å½¹ï¼Œç´…è»äººæ•¸ç”±8.6è¬éŠ³æ¸›è‡³3è¬é¤˜äººã€‚" },
            { question: "æ¹˜æ±Ÿæˆ°å½¹ä¸­ï¼Œè² è²¬å¾Œè¡›ä»»å‹™æœ€çµ‚å…¨è»è¦†æ²’çš„æ˜¯å“ªæ”¯éƒ¨éšŠï¼Ÿ", options: ["ç´…ä¸€è»åœ˜", "ç´…ä¸‰è»åœ˜", "ç´…34å¸«", "ç´…äº”è»åœ˜"], answer: 2, explanation: "ç´…34å¸«ä½œç‚ºã€Œçµ•å‘½å¾Œè¡›å¸«ã€ï¼Œç‚ºæ©è­·ä¸»åŠ›éæ±Ÿï¼Œæœ€çµ‚å…¨è»è¦†æ²’ï¼Œå¸«é•·é™³æ¨¹æ¹˜å£¯çƒˆçŠ§ç‰²ã€‚" },
            { question: "æ¹˜æ±Ÿæˆ°å½¹çš„æ…˜æ•—ç›´æ¥å°è‡´äº†å¾Œä¾†å“ªæ¬¡æœƒè­°çš„å¬é–‹ï¼Ÿ", options: ["å¤ç”°æœƒè­°", "éµç¾©æœƒè­°", "ç“¦çª¯å ¡æœƒè­°", "æ´›å·æœƒè­°"], answer: 1, explanation: "æ…˜é‡çš„çŠ§ç‰²å¼•ç™¼äº†å°éŒ¯èª¤æŒ‡æ®çš„ä¸æ»¿ï¼Œç›´æ¥æ¨å‹•äº†éµç¾©æœƒè­°çš„å¬é–‹ä»¥ç³¾æ­£éŒ¯èª¤ã€‚" }
          ],
          game: {
            scenario: "ã€ç”Ÿæ­»é—œé ­ã€‘æ¶æ¸¡æ¹˜æ±Ÿï¼å…©å´æ•µè»å·²å½¢æˆå£è¢‹é™£ï¼Œå¾Œè¡›ç´…34å¸«è¢«æˆªæ–·åœ¨æ±Ÿæ±ã€‚æ±Ÿé¢æ•µæ©Ÿä¿¯è¡è½Ÿç‚¸ï¼Œæ±Ÿæ°´å·²æŸ“ç´…ã€‚ä¸»åŠ›éƒ¨éšŠé‚„æœ‰å¤§é‡äººå“¡æœªéæ±Ÿã€‚",
            options: [
              { label: "å‘½ä»¤ç´…34å¸«æ­»å®ˆé™£åœ°ï¼Œæ©è­·è»å§”éæ±Ÿ", foodChange: -5, moraleChange: -25, result: "å£¯çƒˆçš„çŠ§ç‰²ï¼ç´…34å¸«å…¨è»è¦†æ²’ï¼ˆé™³æ¨¹æ¹˜æ–·è…¸æ˜å¿—ï¼‰ï¼Œä¸»åŠ›å€–å­˜ä½†å£«æ°£è·Œè‡³è°·åº•ã€‚" },
              { label: "ä¸»åŠ›éƒ¨éšŠå›é ­æ¥æ‡‰å¾Œè¡›", foodChange: -30, moraleChange: 5, result: "è»äº‹è‡ªæ®ºï¼ä¸»åŠ›é‡å›åŒ…åœåœˆï¼Œå°è‡´ç´…è»é¢è‡¨å…¨è»è¦†æ²’çš„å±éšªã€‚" },
              { label: "åŒ–æ•´ç‚ºé›¶ï¼Œåˆ†æ•£çªåœ", foodChange: -15, moraleChange: -20, result: "éƒ¨éšŠå»ºåˆ¶è¢«æ‰“æ•£ï¼Œå¤§é‡éæˆ°é¬¥æ¸›å“¡ï¼Œç´…è»å¯èƒ½å°±æ­¤æ½°æ•£ã€‚" },
              { label: "æ‹‹æ£„æ‰€æœ‰æ–‡ä»¶èˆ‡æ©Ÿå™¨ï¼Œå¼·è¡Œæ¶‰æ°´", foodChange: -10, moraleChange: -5, result: "ä¸Ÿæ£„äº†æœ€å¾Œçš„åŒ…è¢±ï¼Œé›–ç„¶æå¤±ç‰©è³‡ï¼Œä½†ä¿ä½äº†å‰©é¤˜çš„æœ‰ç”ŸåŠ›é‡ã€‚" }
            ]
          }
        },
        {
          id: 2,
          title: "éµç¾©æœƒè­°",
          date: "1935å¹´1æœˆ",
          location: "è²´å·éµç¾©",
          coords: { x: 52, y: 62 },
          description: "ä¸­å…±ä¸­å¤®åœ¨éµç¾©å¬é–‹æ”¿æ²»å±€æ“´å¤§æœƒè­°ã€‚æœƒè­°é›†ä¸­å…¨åŠ›è§£æ±ºäº†ç•¶æ™‚å…·æœ‰æ±ºå®šæ„ç¾©çš„è»äº‹å’Œçµ„ç¹”å•é¡Œï¼Œç³¾æ­£äº†ã€Œå·¦ã€å‚¾æ•™æ¢ä¸»ç¾©éŒ¯èª¤ã€‚",
          significance: "ç¢ºç«‹äº†æ¯›æ¾¤æ±åœ¨é»¨å’Œç´…è»ä¸­çš„é ˜å°åœ°ä½ï¼Œåœ¨æ¥µå…¶å±æ€¥çš„é—œé ­æŒ½æ•‘äº†é»¨ï¼ŒæŒ½æ•‘äº†ç´…è»ï¼Œæ˜¯é»¨çš„æ­·å²ä¸Šä¸€å€‹ç”Ÿæ­»æ”¸é—œçš„è½‰æŠ˜é»ã€‚",
          figures: [
            { name: "æ¯›æ¾¤æ±", role: "æ”¿æ²»å±€å¸¸å§”", desc: "åœ¨æœƒè­°ä¸Šæ‰¹è©•äº†å–®ç´”é˜²ç¦¦è·¯ç·šï¼Œå¢é¸ç‚ºæ”¿æ²»å±€å¸¸å§”ã€‚" },
            { name: "ç‹ç¨¼ç¥¥", role: "ç´…è»ç¸½æ”¿æ²»éƒ¨ä¸»ä»»", desc: "æŠ•å‡ºäº†é—œéµä¸€ç¥¨ï¼Œæ”¯æŒæ¯›æ¾¤æ±çš„ä¸»å¼µã€‚" }
          ],
          survival: {
            title: "é›£å¾—çš„ä¼‘æ•´",
            content: "ä½”é ˜éµç¾©å¾Œï¼Œç´…è»ç²å¾—äº†é•·å¾ä»¥ä¾†é›£å¾—çš„12å¤©ä¼‘æ•´æ™‚é–“ã€‚æˆ°å£«å€‘è£œå……äº†çµ¦é¤Šï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œç²¾ç¥é¢è²Œç…¥ç„¶ä¸€æ–°ã€‚"
          },
          stat: { label: "æœƒè­°æ™‚é•·", value: "3å¤©", icon: "info" },
          quizzes: [
            { question: "éµç¾©æœƒè­°è¢«èªç‚ºæ˜¯ä¸­åœ‹å…±ç”¢é»¨æ­·å²ä¸Šçš„ä»€éº¼ï¼Ÿ", options: ["ç”Ÿæ­»æ”¸é—œçš„è½‰æŠ˜é»", "é•·å¾çš„çµæŸé»", "å»ºé»¨çš„é–‹å§‹", "åœ‹å…±åˆä½œçš„èµ·é»"], answer: 0, explanation: "éµç¾©æœƒè­°æŒ½æ•‘äº†é»¨å’Œç´…è»ï¼Œæ˜¯æ­·å²ä¸Šç”Ÿæ­»æ”¸é—œçš„è½‰æŠ˜é»ã€‚" },
            { question: "éµç¾©æœƒè­°ä¸»è¦è§£æ±ºäº†ä»€éº¼å•é¡Œï¼Ÿ", options: ["æ”¿æ²»å’Œæ€æƒ³å•é¡Œ", "è»äº‹å’Œçµ„ç¹”å•é¡Œ", "ç¶“æ¿Ÿå’Œæ–‡åŒ–å•é¡Œ", "å¤–äº¤å’Œçµ±ä¸€æˆ°ç·šå•é¡Œ"], answer: 1, explanation: "æœƒè­°é›†ä¸­å…¨åŠ›è§£æ±ºäº†ç•¶æ™‚æœ€ç·Šè¿«çš„è»äº‹å•é¡Œå’Œçµ„ç¹”å•é¡Œï¼ˆé ˜å°æ¬Šï¼‰ã€‚" },
            { question: "éµç¾©æœƒè­°äº‹å¯¦ä¸Šç¢ºç«‹äº†èª°åœ¨é»¨å’Œç´…è»ä¸­çš„é ˜å°åœ°ä½ï¼Ÿ", options: ["å‘¨æ©ä¾†", "æœ±å¾·", "æ¯›æ¾¤æ±", "ç‹ç¨¼ç¥¥"], answer: 2, explanation: "æœƒè­°å¢é¸æ¯›æ¾¤æ±ç‚ºæ”¿æ²»å±€å¸¸å§”ï¼Œäº‹å¯¦ä¸Šç¢ºç«‹äº†ä»–çš„é ˜å°åœ°ä½ã€‚" }
          ],
          game: {
            scenario: "ã€è·¯ç·šä¹‹çˆ­ã€‘æ”»å éµç¾©å¾Œï¼Œé»¨å…§å°ã€Œæå¾·å¼ã€çš„æ©Ÿæ¢°æŒ‡æ®æ€¨è²è¼‰é“ã€‚æ˜¯å¦å¬é–‹æ”¿æ²»å±€æ“´å¤§æœƒè­°é€²è¡Œå¾¹åº•æª¢è¨ï¼Ÿé‚„æ˜¯ç¹¼çºŒè½å¾å…±ç”¢åœ‹éš›é¡§å•çš„æŒ‡æ®ï¼Ÿ",
            options: [
              { label: "æ”¯æŒæ¯›æ¾¤æ±ï¼Œæ‰¹åˆ¤å–®ç´”é˜²ç¦¦è·¯ç·š", foodChange: 5, moraleChange: 40, result: "æ­·å²è½‰æŠ˜é»ï¼ç¢ºç«‹äº†æ­£ç¢ºçš„è»äº‹è·¯ç·šï¼Œç´…è»é‡ç²ç”Ÿæ©Ÿï¼Œå£«æ°£ç©ºå‰é«˜æ¼²ï¼" },
              { label: "ç¶­è­·æ¬Šå¨ï¼Œç¹¼çºŒè½å¾æå¾·æŒ‡æ®", foodChange: 0, moraleChange: -30, result: "éŒ¯èª¤è·¯ç·šç¹¼çºŒï¼éƒ¨éšŠå°‡ç¹¼çºŒåœ¨é‚£æ¢é€šå¾€å¤±æ•—çš„é“è·¯ä¸Šæ’å¾—é ­ç ´è¡€æµã€‚" },
              { label: "å°ˆæ³¨æ–¼è£œå……ç³§è‰ï¼Œä¸è«‡æ”¿æ²»", foodChange: 20, moraleChange: -10, result: "è‚šå­é£½äº†ï¼Œä½†è…¦è¢‹ä¾ç„¶ç³Šå¡—ã€‚ä¹‹å¾Œçš„æˆ°é¬¥ä¾ç„¶æœƒå› ç‚ºéŒ¯èª¤æŒ‡æ®è€Œå¤±æ•—ã€‚" },
              { label: "æå‡ºåˆ†å…µä½œæˆ°ä»¥åˆ†æ•£é¢¨éšª", foodChange: -10, moraleChange: -20, result: "å…µåŠ›åˆ†æ•£å°‡è¢«åœ‹æ°‘é»¨å„å€‹æ“Šç ´ï¼Œé€™æ˜¯åš´é‡çš„è»äº‹å†’éšªã€‚" }
            ]
          }
        },
        {
          id: 3,
          title: "å››æ¸¡èµ¤æ°´",
          date: "1935å¹´1æœˆ-3æœˆ",
          location: "å·é»”é‚Šç•Œ",
          coords: { x: 50, y: 60 },
          description: "åœ¨æ¯›æ¾¤æ±æŒ‡æ®ä¸‹ï¼Œç´…è»åœ¨èµ¤æ°´æ²³å…©å²¸ç©¿æ’å¾€è¿”ï¼Œè²æ±æ“Šè¥¿ã€‚é€šéå››æ¬¡æ¸¡æ²³ï¼Œç´…è»å·§å¦™åœ°ç©¿æ’æ–¼åœ‹æ°‘é»¨è»é‡å…µé›†åœ˜ä¹‹é–“ï¼Œè¿·æƒ‘äº†æ•µäººã€‚",
          significance: "å¾¹åº•ç²‰ç¢äº†è”£ä»‹çŸ³ä¼åœ–åœæ®²ç´…è»æ–¼å·é»”æ»‡é‚Šå¢ƒçš„ç‹‚å¦„è¨ˆåŠƒï¼Œå–å¾—äº†æˆ°ç•¥è½‰ç§»ä¸­çš„ä¸»å‹•æ¬Šï¼Œè¢«æ¯›æ¾¤æ±è¦–ç‚ºå…¶ã€Œå¹³ç”Ÿå¾—æ„ä¹‹ç­†ã€ã€‚",
          figures: [
            { name: "æ¯›æ¾¤æ±", role: "æŒ‡æ®è€…", desc: "å±•ç¾äº†é«˜è¶…çš„è»äº‹æŒ‡æ®è—è¡“ï¼Œéˆæ´»æ©Ÿå‹•ã€‚" }
          ],
          survival: {
            title: "æ€¥è¡Œè»èˆ‡é‹å‹•æˆ°",
            content: "ç‚ºäº†èª¿å‹•æ•µäººï¼Œç´…è»å¿…é ˆåœ¨å±±è·¯ä¸­é »ç¹æ€¥è¡Œè»ã€‚ã€Œè‚¥çš„æ‹–ç˜¦ï¼Œç˜¦çš„æ‹–æ­»ã€ï¼Œé€™ç¨®é«˜å¼·åº¦çš„é‹å‹•æˆ°é›–ç„¶ç–²æ†Šï¼Œä½†å»æ˜¯ç”Ÿå­˜çš„å”¯ä¸€å¸Œæœ›ã€‚"
          },
          stat: { label: "æ­·æ™‚", value: "3å€‹å¤šæœˆ", icon: "info" },
          quizzes: [
            { question: "å››æ¸¡èµ¤æ°´çš„ä¸»è¦è»äº‹ç›®çš„æ˜¯ä»€éº¼ï¼Ÿ", options: ["æ¶ˆæ»…æ•µäººä¸»åŠ›", "å°‹æ‰¾ç³§é£Ÿ", "æ“ºè„«æ•µäººåœè¿½å µæˆª", "å»ºç«‹æ ¹æ“šåœ°"], answer: 2, explanation: "å››æ¸¡èµ¤æ°´é€šéé«˜åº¦æ©Ÿå‹•çš„é‹å‹•æˆ°ï¼ŒæˆåŠŸè·³å‡ºäº†æ•µäººçš„åŒ…åœåœˆã€‚" },
            { question: "æ¯›æ¾¤æ±å°‡å“ªå ´æˆ°å½¹ç¨±ç‚ºè‡ªå·±ã€Œå¹³ç”Ÿå¾—æ„ä¹‹ç­†ã€ï¼Ÿ", options: ["é¼ç€‹æˆ°å½¹", "å››æ¸¡èµ¤æ°´", "å¹³å‹é—œå¤§æ·", "ç™¾åœ˜å¤§æˆ°"], answer: 1, explanation: "å› ç‚ºåœ¨æ¥µåº¦åŠ£å‹¢ä¸‹ï¼Œé€šéæŒ‡æ®è—è¡“åŒ–éšªç‚ºå¤·ï¼Œæ•…è¢«ç¨±ç‚ºå¾—æ„ä¹‹ç­†ã€‚" },
            { question: "å››æ¸¡èµ¤æ°´ç™¼ç”Ÿåœ¨é•·å¾çš„å“ªå€‹éšæ®µï¼Ÿ", options: ["é•·å¾åˆæœŸ", "éµç¾©æœƒè­°ä¹‹å¾Œ", "éè‰åœ°ä¹‹å¾Œ", "æœƒå¸«ä¹‹å¾Œ"], answer: 1, explanation: "å››æ¸¡èµ¤æ°´ç™¼ç”Ÿåœ¨éµç¾©æœƒè­°ä¹‹å¾Œï¼Œæ˜¯æ¯›æ¾¤æ±é‡æ–°æŒ‡æ®å¾Œçš„ç¬¬ä¸€å ´å¤§ä»—ã€‚" }
          ],
          game: {
            scenario: "ã€é‹å‹•æˆ°ã€‘éƒ¨éšŠåœ¨èµ¤æ°´æ²³å…©å²¸ä¾†å›ç©¿æ’ï¼ˆå››æ¸¡ï¼‰ã€‚æˆ°å£«å€‘é›™è…³è·‘çˆ›ï¼Œé–‹å§‹æŠ±æ€¨ã€Œèµ°å¼“èƒŒä¸èµ°å¼“å¼¦ã€ã€ã€Œç›¡èµ°å†¤æ‰è·¯ã€ã€‚æ—å½ªä¹Ÿå¯«ä¿¡è¦æ±‚æ›æŒ‡æ®ã€‚",
            options: [
              { label: "å …æŒæ©Ÿå‹•ï¼Œå‘æˆ°å£«è§£é‡‹é€™æ˜¯ã€Œèª¿å‹•æ•µäººã€", foodChange: -15, moraleChange: 15, result: "æ­£ç¢ºçš„é‹å‹•æˆ°ï¼é›–ç„¶èº«é«”æ¥µåº¦ç–²å‹ï¼Œä½†æˆåŠŸè·³å‡ºäº†40è¬æ•µè»çš„é‡åœã€‚" },
              { label: "è½å¾æŠ±æ€¨ï¼Œé¸æ“‡èµ°ç›´ç·šå¿«è·¯", foodChange: 5, moraleChange: -40, result: "èµ°ç›´ç·šæ­£å¥½æ’é€²è”£ä»‹çŸ³ä½ˆç½®çš„ç¢‰å ¡ç·šï¼Œç´…è»é¢è‡¨æ»…é ‚ä¹‹ç½ã€‚" },
              { label: "åœä¸‹ä¾†èˆ‡è¿½å…µæ±ºä¸€æ­»æˆ°", foodChange: -10, moraleChange: -50, result: "ä»¥åµæ“ŠçŸ³ï¼ç´…è»æ­¤æ™‚æ¥µåº¦è™›å¼±ï¼Œé™£åœ°æˆ°å¿…æ•—ç„¡ç–‘ã€‚" },
              { label: "æ›´æ›æŒ‡æ®å“¡ï¼Œè®“æ—å½ªæŒ‡æ®", foodChange: 0, moraleChange: -20, result: "è»å¿ƒå‹•æ–ï¼ŒæŒ‡æ®æ··äº‚ï¼ŒéŒ¯å¤±äº†ç©¿æ’çš„æœ€ä½³æ™‚æ©Ÿã€‚" }
            ]
          }
        },
        {
          id: 4,
          title: "å·§æ¸¡é‡‘æ²™æ±Ÿ",
          date: "1935å¹´5æœˆ",
          location: "é›²å—ç¥¿å‹¸",
          coords: { x: 42, y: 64 },
          description: "ç´…è»åˆ©ç”¨7éš»å°èˆ¹ï¼Œåœ¨ç•¶åœ°èˆ¹å·¥çš„å¹«åŠ©ä¸‹ï¼Œç¶“é9å¤©9å¤œï¼Œå°‡ä¸»åŠ›éƒ¨éšŠå…¨éƒ¨æ¸¡éé‡‘æ²™æ±Ÿã€‚ç•¶åœ‹æ°‘é»¨è»éšŠè¶•åˆ°æ™‚ï¼Œåªèƒ½æœ›æ±Ÿèˆˆå˜†ã€‚",
          significance: "ç´…è»å¾æ­¤è·³å‡ºäº†æ•¸åè¬æ•µè»çš„åŒ…åœåœˆï¼Œç²‰ç¢äº†æ•µäººåœè¿½å µæˆªçš„è¨ˆåŠƒï¼Œå–å¾—äº†æˆ°ç•¥è½‰ç§»çš„æ±ºå®šæ€§å‹åˆ©ã€‚",
          figures: [
            { name: "åŠ‰ä¼¯æ‰¿", role: "ç¸½åƒè¬€é•·", desc: "è¦ªè‡ªæŒ‡æ®å…ˆé£éšŠå¥ªå–çšå¹³æ¸¡å£ã€‚" },
            { name: "ç•¶åœ°èˆ¹å·¥", role: "ç„¡åè‹±é›„", desc: "30å¤šåèˆ¹å·¥æ—¥å¤œä¸åœåœ°æ“ºæ¸¡ï¼Œç‚ºç´…è»åŒ—ä¸Šç«‹ä¸‹å¤§åŠŸã€‚" }
          ],
          survival: {
            title: "èˆ‡æ™‚é–“è³½è·‘",
            content: "æ¸¡æ±Ÿå®Œå…¨ä¾è³´åƒ…æœ‰çš„å¹¾æ¢å°èˆ¹ã€‚ç‚ºäº†åŠ å¿«é€Ÿåº¦ï¼Œéƒ¨éšŠåš´æ ¼æ§åˆ¶ç§©åºï¼Œäººæ­‡èˆ¹ä¸æ­‡ã€‚èˆ¹å·¥å€‘å”±è‘—è™Ÿå­ï¼Œåœ¨æ¹æ€¥çš„æ±Ÿæµä¸­å¾€è¿”ã€‚"
          },
          stat: { label: "æ¸¡èˆ¹æ•¸é‡", value: "åƒ…7éš»å°èˆ¹", icon: "info" },
          quizzes: [
            { question: "å·§æ¸¡é‡‘æ²™æ±Ÿæ¨™èªŒè‘—ç´…è»ï¼Ÿ", options: ["åˆ°é”äº†å»¶å®‰", "è·³å‡ºäº†æ•µäººçš„åŒ…åœåœˆ", "çµæŸäº†é•·å¾", "é–‹å§‹äº†æŠ—æ—¥æˆ°çˆ­"], answer: 1, explanation: "æ¸¡éé‡‘æ²™æ±Ÿå¾Œï¼Œç´…è»å°‡å¹¾åè¬è¿½å…µæ‹‹åœ¨èº«å¾Œï¼Œå–å¾—äº†æˆ°ç•¥è½‰ç§»çš„æ±ºå®šæ€§å‹åˆ©ã€‚" },
            { question: "ç´…è»æ¸¡éé‡‘æ²™æ±Ÿä¸»è¦ä¾é çš„æ˜¯ï¼Ÿ", options: ["æ¶è¨­æµ®æ©‹", "7éš»å°èˆ¹", "æ¸¸éå»", "æ•µäººçš„è»è‰¦"], answer: 1, explanation: "ç´…è»æ§åˆ¶äº†çšå¹³æ¸¡ï¼Œä¾é æ‰¾åˆ°çš„7éš»å°èˆ¹ï¼Œæ™å¤œä¸åœåœ°æ“ºæ¸¡äº†9å¤©9å¤œã€‚" },
            { question: "å·§æ¸¡é‡‘æ²™æ±Ÿæ™‚ï¼Œè² è²¬å¥ªå–æ¸¡å£çš„å…ˆé£éšŠæŒ‡æ®æ˜¯ï¼Ÿ", options: ["æ—å½ª", "å½­å¾·æ‡·", "åŠ‰ä¼¯æ‰¿", "è‘‰åŠè‹±"], answer: 2, explanation: "åŠ‰ä¼¯æ‰¿åŒ–è£å¥‡è¥²ï¼Œæ™ºå–äº†çšå¹³æ¸¡å£ã€‚" }
          ],
          game: {
            scenario: "ã€è»æ°‘é—œä¿‚ã€‘ä¾†åˆ°é‡‘æ²™æ±Ÿçšå¹³æ¸¡ï¼Œå…¨è»åªæœ‰7éš»å°èˆ¹ã€‚å¹¾è¬äººéæ±Ÿéœ€è¦9å¤©9å¤œï¼Œè¿½å…µå°‡è‡³ã€‚ç•¶åœ°èˆ¹å·¥ç–²æ†Šä¸å ªï¼Œäº¦æœ‰å‚³è¨€æ•µè»æœƒæ®ºèˆ¹å·¥å…¨å®¶ã€‚",
            options: [
              { label: "åš´æ ¼åŸ·è¡Œç´€å¾‹ï¼Œåšå¾…èˆ¹å·¥ï¼Œæ®ºè±¬æ¬¾å¾…", foodChange: -15, moraleChange: 25, result: "èˆ¹å·¥è¢«ç´…è»èª æ„æ„Ÿå‹•ï¼Œæ‹¼æ­»æ“ºæ¸¡ï¼Œå‰µé€ äº†å…¨è»ç„¡ä¸€æå¤±æ¸¡æ±Ÿçš„å¥‡è¹Ÿï¼" },
              { label: "å¼·è¡Œå¾µç”¨ï¼Œç”¨æ§é€¼è‘—èˆ¹å·¥åˆ’èˆ¹", foodChange: 0, moraleChange: -25, result: "èˆ¹å·¥æ¶ˆæ¥µæ€ å·¥ç”šè‡³é‘¿æ²‰èˆ¹éš»ï¼Œæ¸¡æ±Ÿå¤±æ•—ï¼Œéƒ¨éšŠèƒŒæ°´ä¸€æˆ°é¢è‡¨å…¨æ®²ã€‚" },
              { label: "ç ä¼æ¨¹æœ¨æ¶è¨­æµ®æ©‹", foodChange: -10, moraleChange: -10, result: "é‡‘æ²™æ±Ÿæ°´æµå¤ªæ€¥ï¼Œæµ®æ©‹æ ¹æœ¬æ¶ä¸èµ·ä¾†ï¼Œæµªè²»äº†å¯¶è²´çš„å…©å¤©æ™‚é–“ã€‚" },
              { label: "ä¸Ÿæ£„æ‰€æœ‰é¦¬åŒ¹ä»¥é¨°å‡ºèˆ¹ä½", foodChange: 15, moraleChange: -15, result: "é›–ç„¶åŠ å¿«äº†é€Ÿåº¦ï¼Œä½†å¤±å»æˆ°é¦¬å°å¾ŒçºŒéé›ªå±±è‰åœ°é€ æˆäº†å·¨å¤§å›°é›£ã€‚" }
            ]
          }
        },
        {
          id: 5,
          title: "é£›å¥ªç€˜å®šæ©‹",
          date: "1935å¹´5æœˆ",
          location: "å››å·ç€˜å®š",
          coords: { x: 42, y: 55 },
          description: "ç´…å››åœ˜æˆ°å£«åœ¨æ™å¤œå…¼ç¨‹240é‡Œå¾Œï¼Œ22åçªæ“ŠéšŠå“¡æ²¿è‘—åªå‰©ä¸‹éµéŠçš„æ©‹é¢ï¼Œå†’è‘—å°å²¸æ•µäººçš„æ©Ÿæ§æƒå°„ï¼Œå¼·è¡Œçªæ“Šï¼Œå¥ªå–äº†å¤§æ©‹ã€‚",
          significance: "ç²‰ç¢äº†è”£ä»‹çŸ³è—‰åŠ©å¤§æ¸¡æ²³å¤©éšªï¼Œè®“ç´…è»æˆç‚ºã€ŒçŸ³é”é–‹ç¬¬äºŒã€çš„ä¼åœ–ï¼Œæ‰“é–‹äº†åŒ—ä¸Šçš„é€šé“ã€‚",
          figures: [
            { name: "22å‹‡å£«", role: "çªæ“ŠéšŠå“¡", desc: "åå­—å¤šå·²ä¸å¯è€ƒï¼Œä»–å€‘æ”€è‘—éµéŠï¼ŒèƒŒè‘—é¦¬åˆ€ï¼Œå†’æ­»è¡é‹’ã€‚" },
            { name: "æ¥Šæˆæ­¦", role: "ç´…å››åœ˜æ”¿å§”", desc: "æŒ‡æ®éƒ¨éšŠåœ¨24å°æ™‚å…§æ€¥è¡Œè»240é‡Œï¼ˆ120å…¬é‡Œï¼‰è¶•åˆ°æ©‹é ­ã€‚" }
          ],
          survival: {
            title: "æ¥µé™æ€¥è¡Œè»",
            content: "ç‚ºäº†æ¶åœ¨æ•µäººæ´å…µä¹‹å‰åˆ°é”ï¼Œç´…å››åœ˜å‰µé€ äº†å–®æ—¥è¡Œè»120å…¬é‡Œçš„å¥‡è¹Ÿã€‚æˆ°å£«å€‘é‚Šè·‘é‚Šåš¼ç”Ÿç±³ï¼Œç”šè‡³äº’ç›¸ç”¨ç¹©å­æ‹‰è‘—è·‘ï¼Œå…‹æœäº†èº«é«”çš„æ¥µé™ã€‚"
          },
          stat: { label: "æ€¥è¡Œè»é€Ÿåº¦", value: "ä¸€æ™å¤œ240é‡Œ", icon: "info" },
          quizzes: [
            { question: "é£›å¥ªç€˜å®šæ©‹çš„çªæ“ŠéšŠå“¡æœ‰å¤šå°‘äººï¼Ÿ", options: ["100äºº", "50äºº", "22äºº", "18äºº"], answer: 2, explanation: "22åå‹‡å£«çµ„æˆäº†çªæ“ŠéšŠï¼Œæ”€è‘—éµç´¢å¥ªä¸‹äº†å¤§æ©‹ã€‚" },
            { question: "ç‚ºäº†å¥ªå–ç€˜å®šæ©‹ï¼Œç´…å››åœ˜å‰µé€ äº†æ€æ¨£çš„è¡Œè»ç´€éŒ„ï¼Ÿ", options: ["ä¸€æ™å¤œ120é‡Œ", "ä¸€æ™å¤œ240é‡Œ", "ä¸€æ™å¤œ80é‡Œ", "ä¸€æ™å¤œ300é‡Œ"], answer: 1, explanation: "ç´…å››åœ˜åœ¨æš´é›¨ä¸­ä¸€æ™å¤œå¥”è¥²240é‡Œï¼ˆç´„120å…¬é‡Œï¼‰ï¼ŒæŒ‰æ™‚è¶•åˆ°ç€˜å®šæ©‹ã€‚" },
            { question: "è”£ä»‹çŸ³æ›¾é è¨€ç´…è»æœƒåœ¨ç€˜å®šæ©‹é‡æ¼”å“ªä½æ­·å²äººç‰©çš„æ‚²åŠ‡ï¼Ÿ", options: ["é …ç¾½", "çŸ³é”é–‹", "æè‡ªæˆ", "æ´ªç§€å…¨"], answer: 1, explanation: "å¤ªå¹³å¤©åœ‹ç¿¼ç‹çŸ³é”é–‹æ›¾åœ¨å¤§æ¸¡æ²³ç•”å…¨è»è¦†æ²’ï¼Œè”£ä»‹çŸ³ä¼åœ–è®“ç´…è»æˆç‚ºã€ŒçŸ³é”é–‹ç¬¬äºŒã€ã€‚" }
          ],
          game: {
            scenario: "ã€æ¥µé™æŒ‘æˆ°ã€‘æ¥åˆ°æ­»å‘½ä»¤ï¼šä¸€æ™å¤œå¿…é ˆæ€¥è¡Œè»240é‡Œå¥ªä¸‹ç€˜å®šæ©‹ï¼å¤§é›¨å‚¾ç›†ï¼Œå±±è·¯æ¿•æ»‘ï¼Œå°å²¸æ•µè»ä¹Ÿåœ¨å¢æ´ã€‚å¤©é»‘äº†ï¼Œå°å²¸å‡ºç¾ç«å…‰ï¼ˆæ•µè»ï¼‰ã€‚",
            options: [
              { label: "é»èµ·ç«æŠŠï¼Œå‡å†’åœ‹æ°‘é»¨æ½°è»åŠ é€Ÿå‰é€²", foodChange: -10, moraleChange: 20, result: "å…µä¸å­è©ï¼é€™æ‹›æˆåŠŸè¿·æƒ‘äº†å°å²¸å·è»ï¼Œç´…å››åœ˜æŒ‰æ™‚åˆ°é”ä¸¦å¥ªä¸‹å¤§æ©‹ï¼" },
              { label: "æ‘¸é»‘å‰é€²ï¼Œé¿å…æš´éœ²", foodChange: -5, moraleChange: 5, result: "é€Ÿåº¦å¤ªæ…¢ï¼Œå¤©äº®æ™‚æ•µè»å¢æ´éƒ¨éšŠå·²ç‚¸æ¯€å¤§æ©‹ï¼Œç´…è»è¢«å›°åœ¨å¤§æ¸¡æ²³ç•”ã€‚" },
              { label: "åœä¸‹ä¼‘æ¯ç…®é£¯ï¼Œæ¢å¾©é«”åŠ›", foodChange: 5, moraleChange: -50, result: "å»¶èª¤æˆ°æ©Ÿï¼é€™æ˜¯è‡´å‘½çš„éŒ¯èª¤ï¼Œä»»å‹™å¤±æ•—æ„å‘³è‘—å…¨è»è¦†æ²’ã€‚" },
              { label: "æ‹‹æ£„æ­¦å™¨æ¸›é‡å¥”è¥²", foodChange: -5, moraleChange: -30, result: "é›–ç„¶è·‘åˆ°äº†ï¼Œä½†æ²’æœ‰é‡æ©Ÿæ§æ©è­·ï¼Œçªæ“ŠéšŠå“¡å…¨éƒ¨çŠ§ç‰²åœ¨éµç´¢æ©‹ä¸Šã€‚" }
            ]
          }
        },
        {
          id: 6,
          title: "çˆ¬é›ªå±±éè‰åœ°",
          date: "1935å¹´6æœˆ-8æœˆ",
          location: "å·è¥¿åŒ—",
          coords: { x: 40, y: 45 },
          description: "ç´…è»ç¿»è¶Šäº†çµ‚å¹´ç©é›ªçš„å¤¾é‡‘å±±ï¼Œç©¿è¶Šäº†äººè·¡ç½•è‡³ã€æ°£å€™æƒ¡åŠ£ã€éå¸ƒæ²¼æ¾¤çš„æ¾æ½˜è‰åœ°ã€‚é€™æ˜¯é•·å¾ä¸­è‡ªç„¶ç’°å¢ƒæœ€æƒ¡åŠ£ã€éæˆ°é¬¥æ¸›å“¡æœ€åš´é‡çš„éšæ®µã€‚",
          significance: "é«”ç¾äº†ç´…è»æˆ°å£«æ¥µå¼·çš„æ„å¿—åŠ›å’Œé©å‘½æ¨‚è§€ä¸»ç¾©ç²¾ç¥ï¼Œæ˜¯é•·å¾ç²¾ç¥çš„é›†ä¸­é«”ç¾ã€‚",
          figures: [
            { name: "ç‚Šäº‹ç­é•·", role: "ç„¡åè‹±é›„", desc: "åœ¨ã€Šé‡‘è‰²çš„é­šé‰¤ã€‹æ•…äº‹ä¸­ï¼Œè€ç­é•·ç…§é¡§ç—…è™Ÿï¼Œè‡ªå·±å»å› é£¢é¤“çŠ§ç‰²ã€‚" }
          ],
          survival: {
            title: "åƒçš®å¸¶èˆ‡é‡èœ",
            content: "ç³§é£Ÿæ–·çµ•å¾Œï¼Œæˆ°å£«å€‘æŒ–é‡èœã€ç…®çš®å¸¶å……é£¢ã€‚è‰åœ°å¤©æ°£ç¬æ¯è¬è®Šï¼Œè¨±å¤šæˆ°å£«å› ç‚ºé™·å…¥æ³¥æ²¼æˆ–é«”æº«éä½è€Œåœ¨ç¡å¤¢ä¸­å†ä¹Ÿæ²’æœ‰é†’ä¾†ã€‚"
          },
          stat: { label: "ä¸»è¦å¨è„…", value: "é£¢é¤“ã€åš´å¯’ã€ç¼ºæ°§", icon: "info" },
          quizzes: [
            { question: "ç´…è»ç¿»è¶Šçš„ç¬¬ä¸€åº§å¤§é›ªå±±æ˜¯ï¼Ÿ", options: ["ç‰é¾é›ªå±±", "å¤¾é‡‘å±±", "é•·ç™½å±±", "å´‘å´™å±±"], answer: 1, explanation: "å¤¾é‡‘å±±æ˜¯ç´…è»é•·å¾ç¿»è¶Šçš„ç¬¬ä¸€åº§å¤§é›ªå±±ï¼Œæµ·æ‹”4000å¤šç±³ã€‚" },
            { question: "éè‰åœ°æ™‚ï¼Œç´…è»é¢è‡¨çš„æœ€å¤§å›°é›£ä¸åŒ…æ‹¬ï¼Ÿ", options: ["éå¸ƒæ²¼æ¾¤", "ç³§é£ŸçŸ­ç¼º", "æ°£å€™æƒ¡åŠ£", "æ•µè»å¤§è¦æ¨¡åœå‰¿"], answer: 3, explanation: "è‰åœ°äººè·¡ç½•è‡³ï¼Œåœ‹æ°‘é»¨è»éšŠä¹Ÿç„¡æ³•é€²å…¥ï¼Œå› æ­¤ä¸»è¦å›°é›£æ˜¯æƒ¡åŠ£çš„è‡ªç„¶ç’°å¢ƒå’Œé£¢é¤“ï¼Œè€Œéæ•µè»åœå‰¿ã€‚" },
            { question: "è‘—åçš„ã€Œé•·å¾ç²¾ç¥ã€åœ¨é€™ä¸€éšæ®µä¸»è¦é«”ç¾åœ¨ï¼Ÿ", options: ["éˆæ´»çš„æˆ°ç•¥æˆ°è¡“", "å¤§ç„¡ç•çš„é©å‘½æ¨‚è§€ä¸»ç¾©", "è»æ°‘é­šæ°´æƒ…", "åœ‹éš›ä¸»ç¾©ç²¾ç¥"], answer: 1, explanation: "é¢å°æ¥µç«¯çš„è‡ªç„¶ç’°å¢ƒï¼Œç´…è»å±•ç¾äº†æŒ‘æˆ°æ¥µé™ã€ä¸æ€•çŠ§ç‰²çš„é©å‘½æ¨‚è§€ä¸»ç¾©ç²¾ç¥ã€‚" }
          ],
          game: {
            scenario: "ã€çµ•å¢ƒæ±‚ç”Ÿã€‘é€²å…¥è‰åœ°ç¬¬ä¸ƒå¤©ï¼Œä¹¾ç³§è€—ç›¡ã€‚çœ¼å‰åªæœ‰ç„¡ç›¡çš„æ³¥æ²¼å’Œä¸çŸ¥åçš„é‡èœã€‚æˆ°å£«å€‘é–‹å§‹æµ®è…«ã€è…¹ç€‰ï¼Œç”šè‡³æœ‰äººæè­°å»æ¶åŠ«é™„è¿‘çš„å–‡å˜›å»Ÿã€‚",
            options: [
              { label: "åš´å®ˆç´€å¾‹ï¼Œç…®çš®å¸¶å’Œç‰›çš®é‹å……é£¢", foodChange: 5, moraleChange: 10, result: "é›–ç„¶é›£ä»¥ä¸‹åš¥ï¼Œä½†ç¶­è­·äº†ç´…è»ç´€å¾‹ï¼Œé è‘—å¾®è–„çš„ç†±é‡æ’éäº†æœ€å¾Œå¹¾å¤©ã€‚" },
              { label: "å˜—è©¦é¡è‰²é®®è±”çš„é‡è˜‘è‡", foodChange: 10, moraleChange: -30, result: "ä¸­æ¯’ï¼å¤§é‡æˆ°å£«å‡ºç¾å¹»è¦ºå’Œå˜”åï¼Œéƒ¨éšŠæˆ°é¬¥åŠ›æ­¸é›¶ã€‚" },
              { label: "æ®ºæ‰åƒ…å­˜çš„æˆ°é¦¬åˆ†é£Ÿ", foodChange: 25, moraleChange: -10, result: "å¿ç—›æ®ºé¦¬ã€‚é›–ç„¶å¤±å»äº†é‹è¼¸å·¥å…·ï¼Œä½†é€™é “è‚‰é£ŸæŒ½æ•‘äº†è¨±å¤šç€•æ­»æˆ°å£«çš„ç”Ÿå‘½ã€‚" },
              { label: "æ¶åŠ«å–‡å˜›å»Ÿçš„ç³§é£Ÿ", foodChange: 40, moraleChange: -50, result: "é•åæ°‘æ—æ”¿ç­–ï¼é›–ç„¶åƒé£½äº†ï¼Œä½†é­åˆ°è—æ—æ­¦è£çš„è¥²æ“Šï¼Œæå¤±æ¯”é£¢é¤“æ›´æ…˜é‡ã€‚" }
            ]
          }
        },
        {
          id: 7,
          title: "å³èµ·é®æœƒå¸«",
          date: "1935å¹´10æœˆ",
          location: "é™åŒ—å³èµ·é®",
          coords: { x: 55, y: 35 },
          description: "ä¸­å¤®ç´…è»åˆ°é”é™åŒ—å³èµ·é®ï¼Œèˆ‡é™åŒ—ç´…è»å‹åˆ©æœƒå¸«ã€‚é€™æ¨™èªŒè‘—ç´…ä¸€æ–¹é¢è»ä¸»åŠ›é•·å¾çš„å‹åˆ©çµæŸã€‚",
          significance: "å®£å‘Šäº†åœ‹æ°‘é»¨åœè¿½å µæˆªçš„å¤±æ•—ï¼Œç‚ºä¸­åœ‹é©å‘½å¤§æœ¬ç‡Ÿæ”¾åœ¨è¥¿åŒ—èˆ‰è¡Œäº†å¥ åŸºç¦®ï¼Œé–‹å•Ÿäº†ä¸­åœ‹é©å‘½çš„æ–°å±€é¢ã€‚",
          figures: [
            { name: "åŠ‰å¿—ä¸¹", role: "é™åŒ—ç´…è»é ˜å°äºº", desc: "å‰µå»ºäº†é™åŒ—é©å‘½æ ¹æ“šåœ°ï¼Œç‚ºä¸­å¤®ç´…è»æä¾›äº†è½è…³é»ã€‚" },
            { name: "ç¿’ä»²å‹³", role: "é™åŒ—ç´…è»é ˜å°äºº", desc: "è¿æ¥ä¸­å¤®ç´…è»çš„åˆ°ä¾†ã€‚" }
          ],
          survival: {
            title: "çª¯æ´èˆ‡å°ç±³",
            content: "åˆ°é”é™åŒ—å¾Œï¼Œæˆ°å£«å€‘ä½é€²äº†çª¯æ´ï¼Œåƒä¸Šäº†å°ç±³é£¯ã€‚é›–ç„¶æ¢ä»¶ä¾ç„¶è‰±è‹¦ï¼Œä½†ç›¸æ¯”è‰åœ°é›ªå±±ï¼Œé€™è£¡å·²ç¶“æ˜¯æº«æš–çš„å®¶ã€‚"
          },
          stat: { label: "ç¸½é‡Œç¨‹", value: "äºŒè¬äº”åƒé‡Œ", icon: "info" },
          quizzes: [
            { question: "ä¸­å¤®ç´…è»é•·å¾çš„è½è…³é»æ˜¯å“ªè£¡ï¼Ÿ", options: ["é™åŒ—", "è¥¿è—", "æ–°ç–†", "åŒ—äº¬"], answer: 0, explanation: "ä¸­å¤®ç´…è»æœ€çµ‚åœ¨é™åŒ—å³èµ·é®èˆ‡ç•¶åœ°ç´…è»æœƒå¸«ï¼Œè½è…³é™åŒ—ã€‚" },
            { question: "èˆ‡ä¸­å¤®ç´…è»åœ¨å³èµ·é®æœƒå¸«çš„æ˜¯å“ªæ”¯éƒ¨éšŠï¼Ÿ", options: ["ç´…äºŒæ–¹é¢è»", "ç´…å››æ–¹é¢è»", "é™åŒ—ç´…è»ï¼ˆç´…åäº”è»åœ˜ï¼‰", "æ–°å››è»"], answer: 2, explanation: "å³èµ·é®æœƒå¸«ä¸»è¦æ˜¯ç´…ä¸€æ–¹é¢è»ï¼ˆä¸­å¤®ç´…è»ï¼‰èˆ‡é™åŒ—ç´…è»çš„æœƒå¸«ã€‚" },
            { question: "é•·å¾å‹åˆ©çµæŸæ¨™èªŒè‘—ä¸­åœ‹é©å‘½é‡å¿ƒè½‰ç§»åˆ°äº†ï¼Ÿ", options: ["æ±åŒ—", "è¥¿åŒ—", "è¥¿å—", "è¯å—"], answer: 1, explanation: "é•·å¾çš„å‹åˆ©ç‚ºä¸­åœ‹é©å‘½å¤§æœ¬ç‡Ÿæ”¾åœ¨è¥¿åŒ—èˆ‰è¡Œäº†å¥ åŸºç¦®ã€‚" }
          ],
          game: {
            scenario: "ã€æœ€å¾Œä¸€æˆ°ã€‘åˆ°é”å³èµ·é®ï¼Œæˆ°å£«å€‘çœ‹åˆ°äº†çª¯æ´ï¼ä½†å°¾éš¨çš„æ•µè»é¨å…µï¼ˆé¦¬å®¶è»ï¼‰ä¸ä¾ä¸é¥’ï¼Œä¼åœ–è¶ç´…è»ç«‹è¶³æœªç©©ç™¼å‹•æ”»æ“Šã€‚æ¯›æ¾¤æ±æè­°ã€Œåˆ‡æ‰é€™å€‹å°¾å·´ã€ã€‚",
            options: [
              { label: "åˆ©ç”¨åœ°å½¢è¨­ä¼ï¼Œæ‰“å€‹æ®²æ»…æˆ°", foodChange: -10, moraleChange: 50, result: "ã€Œåˆ‡å°¾å·´ã€æˆ°å½¹å¤§ç²å…¨å‹ï¼ç”¨ä¸€å ´æ¼‚äº®çš„å‹ä»—å®£å‘Šäº†é•·å¾çš„çµæŸï¼" },
              { label: "åŠ é€Ÿæ’¤å…¥æ ¹æ“šåœ°ï¼Œé¿æˆ°ä¿å…¨", foodChange: 5, moraleChange: 0, result: "é›–ç„¶å®‰å…¨äº†ï¼Œä½†å¸¶è‘—æ•µäººçš„è¿½æ“Šé€²å…¥æ ¹æ“šåœ°ï¼Œé¡¯å¾—ç‹¼ç‹½ï¼Œä¸”å¾Œæ‚£ç„¡çª®ã€‚" },
              { label: "å°±åœ°èˆ‰è¾¦è¯æ­¡æœƒæ…¶ç¥æœƒå¸«", foodChange: 10, moraleChange: -40, result: "å¤§æ„å¤±èŠå·ï¼æ…¶ç¥æ´»å‹•è¢«æ•µè»é¨å…µè¡æ•£ï¼Œæ¨‚æ¥µç”Ÿæ‚²ï¼Œæå¤±æ…˜é‡ã€‚" },
              { label: "è«‹æ±‚é™åŒ—ç´…è»ä»£ç‚ºé˜»æ“Š", foodChange: 0, moraleChange: -10, result: "é›–ç„¶åŠ‰å¿—ä¸¹é¡˜æ„å¹«å¿™ï¼Œä½†é¡¯ç¤ºäº†ä¸­å¤®ç´…è»çš„æ€¯æˆ°ï¼Œå½±éŸ¿äº†æœƒå¸«å¾Œçš„å¨ä¿¡ã€‚" }
            ]
          }
        }
      ];

      // --- 3. çµ„ä»¶: æˆ°è¡“ç¤ºæ„åœ– (EventSchematic) ---
      const EventSchematic = ({ id }) => {
        const RED = "#b71c1c";
        const BLUE = "#607d8b";
        const GREY = "#546e7a";

        const renderContent = () => {
          switch (id) {
            case 0: // ç‘é‡‘
              return (
                <React.Fragment>
                  <text x="50" y="15" textAnchor="middle" fontSize="6" fill={GREY} fontWeight="bold" className="font-serif">åœ‹æ°‘é»¨åŒ…åœåœˆ</text>
                  <circle cx="50" cy="50" r="35" fill="none" stroke={GREY} strokeWidth="1" strokeDasharray="4,2" />
                  <circle cx="50" cy="50" r="3" fill={RED} />
                  <text x="50" y="58" textAnchor="middle" fontSize="5" fill={RED} fontWeight="bold" className="font-serif">ç‘é‡‘</text>
                  <path d="M 45 50 L 25 50" stroke={RED} strokeWidth="2" markerEnd="url(#arrow)" />
                  <text x="35" y="45" textAnchor="middle" fontSize="4" fill={RED} className="font-serif">çªåœ</text>
                </React.Fragment>
              );
            case 1: // æ¹˜æ±Ÿ
              return (
                <React.Fragment>
                   <path d="M 40 10 Q 45 50 40 90" stroke={BLUE} strokeWidth="8" fill="none" opacity="0.5" />
                   <text x="35" y="20" fontSize="5" fill="#455a64" writingMode="tb" className="font-serif">æ¹˜æ±Ÿ</text>
                   <rect x="30" y="20" width="10" height="10" fill={GREY} opacity="0.5" />
                   <rect x="30" y="70" width="10" height="10" fill={GREY} opacity="0.5" />
                   <path d="M 70 50 L 30 50" stroke={RED} strokeWidth="3" markerEnd="url(#arrow)" />
                   <circle cx="40" cy="50" r="4" fill="#c62828" opacity="0.5" />
                   <text x="55" y="45" textAnchor="middle" fontSize="4" fill={RED} className="font-serif">çªç ´å°é–</text>
                </React.Fragment>
              );
            case 2: // éµç¾©
              return (
                <React.Fragment>
                   <rect x="30" y="30" width="40" height="30" rx="2" fill="#8d6e63" />
                   <text x="50" y="48" textAnchor="middle" fontSize="5" fill="white" fontWeight="bold" className="font-serif">éµç¾©æœƒè­°</text>
                   <path d="M 20 80 L 40 60" stroke="#bdbdbd" strokeWidth="2" strokeDasharray="2,2" />
                   <path d="M 50 25 L 50 10" stroke={RED} strokeWidth="3" markerEnd="url(#arrow)" />
                   <text x="70" y="15" textAnchor="middle" fontSize="4" fill={RED} className="font-serif">è»äº‹è½‰æŠ˜</text>
                </React.Fragment>
              );
            case 3: // èµ¤æ°´
              return (
                <React.Fragment>
                   <path d="M 20 10 Q 80 30 20 50 Q 80 70 20 90" stroke={BLUE} strokeWidth="6" fill="none" opacity="0.5" />
                   <path d="M 60 20 Q 10 30 60 40 Q 90 50 40 60 Q 10 70 50 80" stroke={RED} strokeWidth="1.5" fill="none" strokeDasharray="3,1" markerEnd="url(#arrow)" />
                   <text x="80" y="20" textAnchor="middle" fontSize="4" fill={RED} className="font-serif">å››æ¸¡èµ¤æ°´</text>
                   <text x="80" y="26" textAnchor="middle" fontSize="4" fill={RED} className="font-serif">å‡ºå¥‡åˆ¶å‹</text>
                </React.Fragment>
              );
            case 4: // é‡‘æ²™æ±Ÿ
              return (
                <React.Fragment>
                   <path d="M 10 40 Q 50 80 90 40" stroke={BLUE} strokeWidth="8" fill="none" opacity="0.5" />
                   <text x="50" y="70" textAnchor="middle" fontSize="5" fill="#455a64" className="font-serif">é‡‘æ²™æ±Ÿ</text>
                   <circle cx="50" cy="60" r="2" fill="black" />
                   <text x="50" y="55" textAnchor="middle" fontSize="3" fill="black" className="font-serif">çšå¹³æ¸¡</text>
                   <path d="M 50 85 L 50 65" stroke={RED} strokeWidth="2" />
                   <path d="M 50 55 L 50 20" stroke={RED} strokeWidth="2" markerEnd="url(#arrow)" />
                   <text x="70" y="30" textAnchor="middle" fontSize="4" fill={RED} className="font-serif">åŒ—ä¸Šçªåœ</text>
                </React.Fragment>
              );
            case 5: // ç€˜å®šæ©‹
              return (
                <React.Fragment>
                   <rect x="0" y="0" width="30" height="100" fill="#a1887f" />
                   <rect x="70" y="0" width="30" height="100" fill="#a1887f" />
                   <rect x="30" y="0" width="40" height="100" fill={BLUE} opacity="0.7" />
                   <text x="50" y="90" textAnchor="middle" fontSize="5" fill="white" className="font-serif">å¤§æ¸¡æ²³</text>
                   <line x1="30" y1="50" x2="70" y2="50" stroke="#3e2723" strokeWidth="2" />
                   <line x1="30" y1="50" x2="70" y2="50" stroke="black" strokeWidth="0.5" strokeDasharray="1,1" transform="translate(0, -2)" />
                   <path d="M 20 50 L 80 50" stroke={RED} strokeWidth="3" markerEnd="url(#arrow)" />
                   <text x="50" y="40" textAnchor="middle" fontSize="4" fill={RED} fontWeight="bold" className="font-serif">å¼·æ¸¡å¤©éšª</text>
                </React.Fragment>
              );
            case 6: // é›ªå±±
              return (
                <React.Fragment>
                   <path d="M 10 80 L 30 40 L 50 80 L 70 30 L 90 80" fill="none" stroke={GREY} strokeWidth="2" />
                   <path d="M 30 40 L 35 50 M 70 30 L 75 40" stroke="white" strokeWidth="4" strokeLinecap="round" />
                   <path d="M 10 90 Q 30 60 50 90 Q 70 50 90 20" stroke={RED} strokeWidth="1.5" fill="none" strokeDasharray="2,1" markerEnd="url(#arrow)" />
                   <text x="50" y="20" textAnchor="middle" fontSize="4" fill={GREY} className="font-serif">é›ªå±±è‰åœ°</text>
                </React.Fragment>
              );
            case 7: // å³èµ·é®
              return (
                <React.Fragment>
                   <path d="M 30 30 Q 70 20 80 60 Q 40 80 30 30" fill="#fff59d" stroke="#fbc02d" />
                   <text x="55" y="50" textAnchor="middle" fontSize="5" fill="#f57f17" className="font-serif">é™åŒ—æ ¹æ“šåœ°</text>
                   <path d="M 50 90 L 55 60" stroke={RED} strokeWidth="3" markerEnd="url(#arrow)" />
                   <path d="M 90 50 L 70 50" stroke={RED} strokeWidth="3" markerEnd="url(#arrow)" />
                   <text x="60" y="58" textAnchor="middle" fontSize="10" fill="red">â˜…</text>
                   <text x="80" y="80" textAnchor="middle" fontSize="5" fill={RED} fontWeight="bold" className="font-serif">å‹åˆ©æœƒå¸«</text>
                </React.Fragment>
              );
            default: return null;
          }
        };

        return (
          <div className="w-full h-32 bg-[#f5f5f5] rounded-lg border border-[#d7ccc8] mb-4 overflow-hidden relative shadow-inner">
            <div className="absolute top-1 left-2 text-[10px] text-[#a1887f] font-bold uppercase tracking-widest font-serif">æˆ°è¡“ç¤ºæ„åœ–</div>
            <svg viewBox="0 0 100 100" className="w-full h-full" preserveAspectRatio="xMidYMid meet">
              <defs>
                <marker id="arrow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                  <path d="M0,0 L0,6 L6,3 z" fill="#b71c1c" />
                </marker>
              </defs>
              {renderContent()}
            </svg>
          </div>
        );
      };

      // --- 4. çµ„ä»¶: æ¸¬é©—æ¨¡æ…‹æ¡† (QuizModal) ---
      const QuizModal = ({ quizzes, isOpen, onClose }) => {
        const [currentQIndex, setCurrentQIndex] = useState(0);
        const [selected, setSelected] = useState(null);
        const [showResult, setShowResult] = useState(false);
        const [score, setScore] = useState(0);
        const [isFinished, setIsFinished] = useState(false);

        useEffect(() => { if (isOpen) resetQuiz(); }, [isOpen, quizzes]);

        const resetQuiz = () => {
          setCurrentQIndex(0);
          setSelected(null);
          setShowResult(false);
          setScore(0);
          setIsFinished(false);
        };

        if (!isOpen || !quizzes || quizzes.length === 0) return null;
        const currentQuiz = quizzes[currentQIndex];

        const handleCheck = () => {
          if (selected !== null) {
            setShowResult(true);
            if (selected === currentQuiz.answer) setScore(prev => prev + 1);
          }
        };

        const handleNext = () => {
          if (currentQIndex < quizzes.length - 1) {
            setCurrentQIndex(prev => prev + 1);
            setSelected(null);
            setShowResult(false);
          } else {
            setIsFinished(true);
          }
        };

        return (
          <div className="fixed inset-0 bg-[#263238]/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 transition-opacity animate-in fade-in duration-200">
            <div className="bg-[#fff8e1] rounded-xl shadow-2xl max-w-lg w-full p-6 border-4 border-[#ff6f00] animate-fade-in-zoom relative overflow-hidden">
              <div className="flex justify-between items-center mb-6 border-b border-[#ffe082] pb-4">
                <h3 className="text-xl font-bold text-[#e65100] flex items-center gap-2 font-serif"><HelpCircle size={24}/> éš¨å ‚çŸ¥è­˜å•ç­”</h3>
                <button onClick={onClose} className="text-[#a1887f] hover:text-[#5d4037] transition-colors"><X size={24}/></button>
              </div>
              {!isFinished ? (
                <React.Fragment>
                  <div className="mb-6">
                     <div className="flex justify-between text-xs font-bold text-[#8d6e63] uppercase mb-1"><span>å•é¡Œ {currentQIndex + 1} / {quizzes.length}</span><span>å¾—åˆ†: {score}</span></div>
                     <div className="w-full bg-[#ffecb3] h-2.5 rounded-full overflow-hidden border border-[#ffe082]"><div className="bg-[#ff8f00] h-full transition-all duration-300 shadow-[0_0_10px_rgba(255,143,0,0.5)]" style={{ width: `${((currentQIndex + 1) / quizzes.length) * 100}%` }}></div></div>
                  </div>
                  <h4 className="text-lg font-bold text-[#3e2723] mb-6 min-h-[3.5rem] leading-snug">{currentQuiz.question}</h4>
                  <div className="space-y-3 mb-6">
                    {currentQuiz.options.map((option, idx) => {
                      let btnClass = "w-full text-left p-4 rounded-xl border-2 transition-all duration-200 outline-none relative ";
                      if (showResult) {
                        if (idx === currentQuiz.answer) btnClass += "bg-[#e8f5e9] border-[#43a047] text-[#1b5e20] font-bold shadow-sm";
                        else if (idx === selected && idx !== currentQuiz.answer) btnClass += "bg-[#ffebee] border-[#e53935] text-[#b71c1c] opacity-80";
                        else btnClass += "border-[#e0e0e0] opacity-40";
                      } else {
                        btnClass += selected === idx ? "border-[#ff8f00] bg-[#fff3e0] text-[#e65100] shadow-md transform scale-[1.01]" : "border-[#d7ccc8] hover:border-[#ffcc80] hover:bg-[#fffde7] text-[#5d4037] bg-white";
                      }
                      return (
                        <button key={idx} onClick={() => !showResult && setSelected(idx)} className={btnClass} disabled={showResult}>
                          <div className="flex justify-between items-center">
                            <span className="flex gap-3"><span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border shrink-0 ${showResult && idx === currentQuiz.answer ? 'bg-[#43a047] text-white border-[#43a047]' : (selected === idx ? 'bg-[#ff8f00] text-white border-[#ff8f00]' : 'bg-[#efebe9] text-[#8d6e63] border-[#bcaaa4]')}`}>{String.fromCharCode(65 + idx)}</span>{option}</span>
                            {showResult && idx === currentQuiz.answer && <CheckCircle size={20} className="text-[#43a047]" />}
                            {showResult && idx === selected && idx !== currentQuiz.answer && <XCircle size={20} className="text-[#e53935]" />}
                          </div>
                        </button>
                      );
                    })}
                  </div>
                  <div className="mt-4">
                    {showResult && currentQuiz.explanation && <div className="mb-4 bg-white p-4 rounded-lg text-sm text-[#4e342e] border border-[#ffcc80] animate-in fade-in slide-in-from-top-2 shadow-sm"><span className="font-bold text-[#e65100] mr-2 block mb-1">ğŸ’¡ çŸ¥è­˜é»è§£æ:</span>{currentQuiz.explanation}</div>}
                    <div className="flex justify-end">
                      {!showResult ? <button onClick={handleCheck} disabled={selected === null} className="px-6 py-2 bg-[#e65100] text-white rounded-lg font-bold hover:bg-[#ef6c00] disabled:opacity-50 disabled:bg-[#bdbdbd] disabled:cursor-not-allowed transition-all transform active:scale-95 shadow-md">æäº¤ç­”æ¡ˆ</button> : <button onClick={handleNext} className="flex items-center gap-2 px-6 py-2 bg-[#3e2723] text-white rounded-lg font-bold hover:bg-[#4e342e] transition-all transform active:scale-95 shadow-md">{currentQIndex < quizzes.length - 1 ? "ä¸‹ä¸€é¡Œ" : "æŸ¥çœ‹æˆç¸¾"} <ChevronRight size={18} /></button>}
                    </div>
                  </div>
                </React.Fragment>
              ) : (
                <div className="text-center py-6 animate-in zoom-in duration-300">
                   <div className="relative inline-block mb-4"><div className={`p-4 rounded-full ${score === quizzes.length ? 'bg-[#fff8e1] border-4 border-[#ffca28]' : 'bg-[#f5f5f5]'}`}><Trophy size={64} className={`${score === quizzes.length ? 'text-[#ffca28]' : 'text-[#bdbdbd]'}`} /></div>{score === quizzes.length && <div className="absolute -top-2 -right-2 text-[#e53935] animate-bounce"><Star size={32} fill="currentColor"/></div>}</div>
                   <h2 className="text-3xl font-black text-[#3e2723] mb-2 font-serif">æ¸¬é©—çµæŸ</h2>
                   <p className="text-[#8d6e63] mb-6">æ‚¨çš„æ­·å²çŸ¥è­˜æ°´å¹³</p>
                   <div className="text-6xl font-black text-[#e65100] mb-2 tracking-tight">{score} <span className="text-2xl text-[#bdbdbd] font-medium">/ {quizzes.length}</span></div>
                   <p className={`font-bold text-lg mb-8 ${score === quizzes.length ? 'text-[#2e7d32]' : (score >= quizzes.length / 2 ? 'text-[#f57f17]' : 'text-[#c62828]')}`}>{score === quizzes.length ? "å¤ªæ£’äº†ï¼æ‚¨æ˜¯é•·å¾çŸ¥è­˜é€šï¼" : (score >= quizzes.length / 2 ? "æˆç¸¾ä¸éŒ¯ï¼Œç¹¼çºŒä¿æŒï¼" : "å»ºè­°å†ä»”ç´°é–±è®€æ­·å²è³‡æ–™å–”ã€‚")}</p>
                   <div className="flex justify-center gap-4"><button onClick={resetQuiz} className="flex items-center gap-2 px-6 py-2 border-2 border-[#d7ccc8] text-[#5d4037] rounded-lg hover:bg-[#efebe9] hover:border-[#bcaaa4] font-bold transition-colors"><RefreshCw size={18} /> é‡æ¸¬</button><button onClick={onClose} className="px-8 py-2 bg-[#b71c1c] text-white rounded-lg font-bold hover:bg-[#c62828] shadow-lg hover:shadow-xl transition-all">å®Œæˆ</button></div>
                </div>
              )}
            </div>
          </div>
        );
      };

      // --- 5. çµ„ä»¶: ç”Ÿå­˜éŠæˆ²æ¨¡æ…‹æ¡† (SurvivalGameModal) ---
      const SurvivalGameModal = ({ milestones, isOpen, onClose }) => {
        const [gameState, setGameState] = useState('intro');
        const [currentStage, setCurrentStage] = useState(0);
        const [food, setFood] = useState(60); 
        const [morale, setMorale] = useState(60); 
        const [feedback, setFeedback] = useState(null);
        const [lastChanges, setLastChanges] = useState(null);
        const [randomEvent, setRandomEvent] = useState(null);
        
        const [foodShaking, setFoodShaking] = useState(false);
        const [moraleShaking, setMoraleShaking] = useState(false);

        useEffect(() => { if (isOpen) resetGame(); }, [isOpen]);

        const resetGame = () => {
          setGameState('intro');
          setCurrentStage(0);
          setFood(60);
          setMorale(60);
          setFeedback(null);
          setLastChanges(null);
          setRandomEvent(null);
        };

        const handleOptionSelect = (option) => {
          const newFood = Math.min(100, Math.max(0, food + option.foodChange));
          const newMorale = Math.min(100, Math.max(0, morale + option.moraleChange));
          
          if (option.foodChange < 0) { setFoodShaking(true); setTimeout(() => setFoodShaking(false), 500); }
          if (option.moraleChange < 0) { setMoraleShaking(true); setTimeout(() => setMoraleShaking(false), 500); }

          setFood(newFood);
          setMorale(newMorale);
          setFeedback(option.result);
          setLastChanges({ food: option.foodChange, morale: option.moraleChange });

          if (newFood <= 0 || newMorale <= 0) { setTimeout(() => setGameState('gameover'), 2000); }
        };

        const nextStage = () => {
          setFeedback(null);
          setLastChanges(null);
          setRandomEvent(null);

          const eventChance = Math.random();
          let currentFood = food;
          let currentMorale = morale;

          if (eventChance < 0.3 && currentStage < milestones.length - 1 && currentFood > 10 && currentMorale > 10) {
              const events = [
                  { text: "é­é‡æ•µæ©Ÿè½Ÿç‚¸ï¼ç³§é£Ÿè¢«ç‡’æ¯€ï¼", f: -10, m: 0 },
                  { text: "æš´é›¨å°è‡´å‚·å¯’æµè¡Œï¼Œå£«æ°£ä½è½ã€‚", f: 0, m: -10 },
                  { text: "è¿·è·¯å¤šèµ°äº†å†¤æ‰è·¯ï¼Œæ¶ˆè€—é«”åŠ›ã€‚", f: -5, m: -5 }
              ];
              const evt = events[Math.floor(Math.random() * events.length)];
              currentFood = Math.max(0, currentFood + evt.f);
              currentMorale = Math.max(0, currentMorale + evt.m);
              setFood(currentFood);
              setMorale(currentMorale);
              setRandomEvent(evt.text);
              setFoodShaking(true);
              setMoraleShaking(true);
              setTimeout(() => {setFoodShaking(false); setMoraleShaking(false);}, 500);
          }

          if (currentFood <= 0 || currentMorale <= 0) { setGameState('gameover'); return; }
          if (currentStage < milestones.length - 1) { setCurrentStage(prev => prev + 1); } else { setGameState('result'); }
        };

        const getRank = (score) => {
          if (score >= 160) return { title: "é•·å¾è»ç¥", color: "text-[#f9a825]", desc: "ä½ çš„æŒ‡æ®è—è¡“å‡ºç¥å…¥åŒ–ï¼Œå ªæ¯”æ¯›æ¾¤æ±ï¼" };
          if (score >= 120) return { title: "å„ªç§€æŒ‡æ®å“¡", color: "text-[#c62828]", desc: "ä½ å¸¶é ˜éƒ¨éšŠå®Œå¥½ç„¡æåœ°åˆ°é”äº†é™åŒ—ã€‚" };
          if (score >= 80) return { title: "åˆæ ¼æˆ°å£«", color: "text-[#1565c0]", desc: "é›–ç„¶æ­·ç¶“ç£¨é›£ï¼Œä½†ä½ å …æŒåˆ°äº†æœ€å¾Œã€‚" };
          return { title: "å€–å­˜è€…", color: "text-[#4e342e]", desc: "ä½ å‹‰å¼·æ´»äº†ä¸‹ä¾†ï¼Œé€™æœ¬èº«å°±æ˜¯å¥‡è¹Ÿã€‚" };
        };

        if (!isOpen) return null;
        const currentMilestone = milestones[currentStage];
        const challenge = currentMilestone.game;
        const totalScore = food + morale;
        const rank = getRank(totalScore);
        const getBarColor = (value, type) => {
            if (value <= 30) return 'bg-[#c62828]';
            if (value <= 60) return 'bg-[#fbc02d]';
            return type === 'food' ? 'bg-[#ff9800]' : 'bg-[#e53935]';
        };

        return (
          <div className="fixed inset-0 bg-[#263238]/90 backdrop-blur-md flex items-center justify-center z-50 p-4 animate-in fade-in duration-300">
            <div className="bg-[#fdfbf7] rounded-xl max-w-4xl w-full shadow-2xl overflow-hidden border-4 border-[#5d4037] flex flex-col max-h-[95vh] relative">
              <div className="bg-[#3e2723] p-4 text-[#fff8e1] flex justify-between items-center shrink-0 shadow-lg z-10 border-b border-[#5d4037]"><div className="flex items-center gap-2"><Trophy size={20} className="text-[#fbc02d]" /><h2 className="text-lg font-bold tracking-widest uppercase font-serif">ç”Ÿå­˜æŒ‘æˆ°æ¨¡å¼</h2></div><button onClick={onClose} className="hover:text-white transition-colors bg-white/10 p-1.5 rounded-full hover:bg-white/20"><X size={20} /></button></div>
              
              {gameState === 'intro' && (
                <div className="p-8 flex flex-col items-center text-center space-y-6 bg-paper overflow-y-auto h-full justify-center">
                  <div className="w-24 h-24 bg-[#8b1c1c] rounded-full flex items-center justify-center mb-2 shadow-xl border-4 border-[#d7ccc8] animate-in zoom-in duration-500"><Wheat size={48} className="text-[#fdd835]" /></div>
                  <h1 className="text-4xl font-black text-[#3e2723] font-serif">é‡èµ°é•·å¾è·¯</h1>
                  <div className="bg-[#fff3e0] p-6 rounded-lg border border-[#ffe0b2] max-w-lg mx-auto shadow-sm relative"><div className="absolute top-2 left-2 text-[#ffcc80]"><Scroll size={20} /></div><p className="text-[#4e342e] text-base md:text-lg leading-relaxed font-serif text-justify font-medium pt-2">1934å¹´ï¼Œç”±æ–¼ç¬¬äº”æ¬¡åã€Œåœå‰¿ã€å¤±æ•—ï¼Œåœ‹æ°‘é»¨è»éšŠæ­¥æ­¥é€²é€¼ã€‚ä¸­å¤®ç´…è»è¢«è¿«æ’¤é›¢æ ¹æ“šåœ°ï¼Œé–‹å§‹æˆ°ç•¥è½‰ç§»ã€‚å‰æœ‰å µæˆªï¼Œå¾Œæœ‰è¿½å…µã€‚ä½ è‡¨å±å—å‘½ï¼Œå¿…é ˆå¸¶é ˜éƒ¨éšŠåœ¨çµ•å¢ƒä¸­æ±‚ç”Ÿã€‚</p></div>
                  <div className="grid grid-cols-2 gap-8 w-full max-w-sm mt-4"><div className="flex flex-col items-center gap-2 p-4 bg-white rounded-xl border border-[#d7ccc8] shadow-sm"><span className="font-bold text-[#f57f17] text-3xl">60</span><div className="flex items-center gap-1 text-xs text-[#5d4037] uppercase font-bold"><Wheat size={14}/> åˆå§‹ç³§é£Ÿ</div></div><div className="flex flex-col items-center gap-2 p-4 bg-white rounded-xl border border-[#d7ccc8] shadow-sm"><span className="font-bold text-[#c62828] text-3xl">60</span><div className="flex items-center gap-1 text-xs text-[#5d4037] uppercase font-bold"><Heart size={14}/> åˆå§‹å£«æ°£</div></div></div>
                  <button onClick={() => setGameState('playing')} className="px-10 py-3 bg-[#b71c1c] text-[#fff8e1] text-xl font-bold rounded-xl shadow-lg hover:shadow-xl hover:bg-[#c62828] transform hover:-translate-y-0.5 active:translate-y-0 transition-all w-full md:w-auto mt-6 border border-[#ef5350]">æ¥å—å‘½ä»¤</button>
                </div>
              )}

              {gameState === 'playing' && challenge && (
                <div className="flex flex-col h-full bg-paper">
                  <div className="bg-[#efebe9] p-4 flex justify-around items-center border-b border-[#d7ccc8] shadow-inner shrink-0 z-10">
                     <div className={`flex flex-col md:flex-row items-center gap-2 md:gap-4 w-1/2 justify-center transition-transform ${foodShaking ? 'translate-x-[-2px]' : ''}`}><div className="flex items-center gap-2 text-[#f57f17] font-bold text-sm uppercase"><Wheat size={18} /> ç³§é£Ÿ</div><div className="w-full max-w-[140px] h-4 bg-[#d7ccc8] rounded-full overflow-hidden border border-[#bcaaa4] relative shadow-inner"><div className={`h-full transition-all duration-700 ${getBarColor(food, 'food')}`} style={{ width: `${food}%` }}></div></div><span className={`font-mono font-bold w-8 text-right text-lg ${food <= 30 ? 'text-[#c62828]' : 'text-[#5d4037]'}`}>{food}</span></div>
                     <div className="h-8 w-px bg-[#d7ccc8]"></div>
                     <div className={`flex flex-col md:flex-row items-center gap-2 md:gap-4 w-1/2 justify-center transition-transform ${moraleShaking ? 'translate-x-[-2px]' : ''}`}><div className="flex items-center gap-2 text-[#c62828] font-bold text-sm uppercase"><Heart size={18} /> å£«æ°£</div><div className="w-full max-w-[140px] h-4 bg-[#d7ccc8] rounded-full overflow-hidden border border-[#bcaaa4] relative shadow-inner"><div className={`h-full transition-all duration-700 ${getBarColor(morale, 'morale')}`} style={{ width: `${morale}%` }}></div></div><span className={`font-mono font-bold w-8 text-right text-lg ${morale <= 30 ? 'text-[#c62828]' : 'text-[#5d4037]'}`}>{morale}</span></div>
                  </div>
                  {randomEvent && <div className="bg-[#ffcdd2] border-b border-[#ef9a9a] p-2 text-center text-[#b71c1c] font-bold flex items-center justify-center gap-2 animate-slide-up shadow-sm"><AlertTriangle size={18} />çªç™¼ï¼š{randomEvent}</div>}
                  <div className="flex-1 overflow-y-auto p-6 md:p-8 custom-scrollbar">
                     <div className="flex justify-between items-center mb-4 pb-2 border-b border-[#d7ccc8]"><span className="text-xs font-bold text-[#8d6e63] border border-[#d7ccc8] px-2 py-1 rounded bg-white">ç¬¬ {currentStage + 1} é—œ</span><span className="text-sm font-bold text-[#5d4037] font-serif tracking-wide">{currentMilestone.date}</span></div>
                     <h2 className="text-2xl md:text-3xl font-black text-[#3e2723] mb-4 font-serif">{currentMilestone.title}</h2>
                     <div className="bg-white p-6 rounded-xl border border-[#d7ccc8] mb-8 shadow-sm flex gap-4"><ShieldCheck className="shrink-0 text-[#8d6e63] mt-1" size={28} /><p className="text-base md:text-lg text-[#4e342e] font-medium leading-relaxed font-serif">{challenge.scenario}</p></div>
                     {feedback ? (
                       <div className="animate-in zoom-in duration-300 bg-[#fff8e1] border-2 border-[#ffecb3] rounded-xl p-8 shadow-lg text-center max-w-2xl mx-auto">
                          <h3 className="text-xl font-bold text-[#3e2723] mb-2 font-serif">å¾Œæœ</h3><p className="text-[#5d4037] mb-8 text-lg">{feedback}</p>
                          <div className="flex justify-center gap-12 mb-8 border-t border-b border-[#ffe0b2] py-4">{lastChanges && (<><div className={`flex flex-col items-center ${lastChanges.food === 0 ? 'opacity-50' : ''}`}><span className="text-xs text-[#8d6e63] font-bold uppercase mb-1">ç³§é£Ÿè®Šå‹•</span><span className={`text-2xl font-black ${lastChanges.food >= 0 ? 'text-[#388e3c]' : 'text-[#c62828]'}`}>{lastChanges.food > 0 ? '+' : ''}{lastChanges.food}</span></div><div className={`flex flex-col items-center ${lastChanges.morale === 0 ? 'opacity-50' : ''}`}><span className="text-xs text-[#8d6e63] font-bold uppercase mb-1">å£«æ°£è®Šå‹•</span><span className={`text-2xl font-black ${lastChanges.morale >= 0 ? 'text-[#388e3c]' : 'text-[#c62828]'}`}>{lastChanges.morale > 0 ? '+' : ''}{lastChanges.morale}</span></div></>)}</div>
                          <button onClick={nextStage} className="inline-flex items-center gap-2 px-8 py-3 bg-[#3e2723] text-[#fff8e1] rounded-lg font-bold hover:bg-[#4e342e] transition-all shadow-md hover:shadow-lg">{currentStage < milestones.length - 1 ? "ç¹¼çºŒå‰é€²" : "æŸ¥çœ‹çµæœ"} <ArrowRight size={20} /></button>
                       </div>
                     ) : (
                       <div className="grid grid-cols-1 md:grid-cols-2 gap-4">{challenge.options.map((option, idx) => (<button key={idx} onClick={() => handleOptionSelect(option)} className="text-left p-5 bg-white border-2 border-[#d7ccc8] rounded-xl hover:border-[#b71c1c] hover:bg-[#ffebee] hover:shadow-md transition-all group relative overflow-hidden flex flex-col h-full"><div className="flex gap-3"><span className="flex-shrink-0 w-8 h-8 rounded-full bg-[#eceff1] text-[#455a64] flex items-center justify-center font-bold text-sm group-hover:bg-[#ffcdd2] group-hover:text-[#b71c1c] transition-colors border border-[#cfd8dc]">{String.fromCharCode(65 + idx)}</span><span className="font-bold text-[#3e2723] text-base md:text-lg group-hover:text-[#b71c1c] leading-tight">{option.label}</span></div></button>))}</div>
                     )}
                  </div>
                </div>
              )}

              {gameState === 'gameover' && (
                <div className="p-8 flex flex-col items-center text-center justify-center h-full space-y-6 bg-[#ffebee]">
                   <div className="relative"><Skull size={80} className="text-[#c62828] animate-pulse" /></div><h2 className="text-4xl font-black text-[#b71c1c] font-serif">é•·å¾å¤±æ•—</h2>
                   <div className="bg-white p-6 rounded-xl shadow-sm border border-[#ef9a9a] max-w-md"><p className="text-[#c62828] text-lg font-medium">{food <= 0 ? "ç³§é£Ÿè€—ç›¡ï¼Œéƒ¨éšŠé£¢å¯’äº¤è¿«ï¼Œå€’åœ¨äº†é›ªå±±è‰åœ°ä¹‹ä¸­ã€‚" : "å£«æ°£å´©æ½°ï¼Œéƒ¨éšŠæ¸™æ•£ï¼Œåœ¨æ•µäººçš„åœè¿½å µæˆªä¸‹å¤±æ•—äº†ã€‚"}</p></div>
                   <button onClick={resetGame} className="flex items-center gap-2 px-8 py-3 bg-[#c62828] text-white font-bold rounded-xl hover:bg-[#b71c1c] transition-all shadow-lg hover:shadow-red-900/30 mt-4"><RefreshCw size={20} /> é‡æ–°æŒ‘æˆ°</button>
                </div>
              )}

              {gameState === 'result' && (
                <div className="p-8 flex flex-col items-center text-center justify-center h-full space-y-6 bg-[#fff8e1]">
                   <div className="relative animate-bounce"><Trophy size={100} className="text-[#ffb300] drop-shadow-xl" /><Star size={40} className="text-[#d32f2f] absolute -top-4 -right-4 animate-spin-slow drop-shadow-md" fill="currentColor" /></div>
                   <div><h2 className="text-4xl font-black text-[#e65100] mb-2 font-serif">é•·å¾å‹åˆ©ï¼</h2><p className="text-[#f57f17] text-lg max-w-md mx-auto font-medium">ä½ å…‹æœäº†é‡é‡å›°é›£ï¼Œå¸¶é ˜ç´…è»åˆ°é”é™åŒ—ï¼</p></div>
                   <div className="bg-white p-8 rounded-xl shadow-xl border-4 border-[#ffb300] w-full max-w-sm relative overflow-hidden">
                      <div className="text-xs text-[#8d6e63] font-bold uppercase tracking-widest mb-2">ç²å¾—æ¦®è­½ç¨±è™Ÿ</div><div className={`text-3xl font-black ${rank.color} flex items-center justify-center gap-2 mb-2 font-serif`}><Medal size={32} /> {rank.title}</div><p className="text-sm text-[#5d4037] italic border-b border-[#ffe0b2] pb-4 mb-4">{rank.desc}</p>
                      <div className="flex justify-between items-end"><div className="text-left"><div className="text-xs text-[#8d6e63] font-bold uppercase">ç¸½å¾—åˆ†</div><div className="text-4xl font-black text-[#3e2723] leading-none">{totalScore}</div></div><div className="flex gap-4 text-sm font-bold text-[#5d4037]"><div className="flex flex-col items-center"><Wheat size={16} className="text-[#f57f17]"/> <span>{food}</span></div><div className="flex flex-col items-center"><Heart size={16} className="text-[#c62828]"/> <span>{morale}</span></div></div></div>
                   </div>
                   <div className="flex gap-4 mt-2"><button onClick={onClose} className="px-6 py-2 border-2 border-[#d7ccc8] text-[#5d4037] font-bold rounded-lg hover:bg-[#efebe9] transition-all">è¿”å›åœ°åœ–</button><button onClick={resetGame} className="flex items-center gap-2 px-6 py-2 bg-[#b71c1c] text-white font-bold rounded-lg hover:bg-[#c62828] transition-all shadow-md hover:shadow-lg"><RefreshCw size={18} /> å†ç©ä¸€æ¬¡</button></div>
                </div>
              )}
            </div>
          </div>
        );
      };

      // --- 6. çµ„ä»¶: åœ°åœ–è¦–åœ– (MapView) ---
      const MapView = ({ currentStep, onNodeClick }) => {
        const [hoveredIndex, setHoveredIndex] = useState(null);
        const timelineRef = useRef(null);

        const PROVINCES = [{ name: 'æ±Ÿè¥¿', x: 74, y: 70, r: 0 }, { name: 'ç¦å»º', x: 80, y: 72, r: 0 }, { name: 'æ¹–å—', x: 65, y: 68, r: 0 }, { name: 'è²´å·', x: 55, y: 70, r: 0 }, { name: 'é›²å—', x: 42, y: 78, r: -15 }, { name: 'å››å·', x: 48, y: 58, r: 0 }, { name: 'è¥¿åº·', x: 30, y: 58, r: 0 }, { name: 'é™è¥¿', x: 60, y: 48, r: 0 }, { name: 'ç”˜è‚…', x: 45, y: 40, r: 0 }, { name: 'å±±è¥¿', x: 68, y: 38, r: 0 }, { name: 'æ²³å—', x: 70, y: 50, r: 0 }, { name: 'æ¹–åŒ—', x: 68, y: 60, r: 0 }, { name: 'å»£æ±', x: 72, y: 82, r: 0 }, { name: 'å»£è¥¿', x: 60, y: 80, r: 0 }, { name: 'é’æµ·', x: 30, y: 42, r: 0 }, { name: 'è¥¿è—', x: 20, y: 60, r: 0 }, { name: 'å…§è’™å¤', x: 60, y: 25, r: 0 }, { name: 'æ–°ç–†', x: 15, y: 25, r: 0 }];
        const CITIES = [{ name: 'åŒ—å¹³', x: 76, y: 32 }, { name: 'å—äº¬', x: 82, y: 58 }, { name: 'ä¸Šæµ·', x: 88, y: 60 }, { name: 'å»£å·', x: 72, y: 85 }, { name: 'è¥¿å®‰', x: 60, y: 48 }, { name: 'æˆéƒ½', x: 48, y: 58 }, { name: 'æ˜†æ˜', x: 40, y: 78 }, { name: 'æ­¦æ¼¢', x: 70, y: 60 }, { name: 'è˜­å·', x: 50, y: 42 }];

        useEffect(() => {
          if (timelineRef.current) {
            const activeNode = timelineRef.current.children[currentStep];
            if (activeNode) {
              const containerWidth = timelineRef.current.offsetWidth;
              const nodeLeft = activeNode.offsetLeft;
              const nodeWidth = activeNode.offsetWidth;
              timelineRef.current.scrollTo({ left: nodeLeft - containerWidth / 2 + nodeWidth / 2, behavior: 'smooth' });
            }
          }
        }, [currentStep]);

        const generatePath = () => { let d = `M ${MILESTONES[0].coords.x} ${MILESTONES[0].coords.y}`; for (let i = 1; i < MILESTONES.length; i++) { d += ` L ${MILESTONES[i].coords.x} ${MILESTONES[i].coords.y}`; } return d; };
        const generateActivePath = () => { if (currentStep === 0) return ""; let d = `M ${MILESTONES[0].coords.x} ${MILESTONES[0].coords.y}`; for (let i = 1; i <= currentStep; i++) { d += ` L ${MILESTONES[i].coords.x} ${MILESTONES[i].coords.y}`; } return d; };

        const renderTerrainDecorations = () => (
          <g className="pointer-events-none opacity-60">
            <foreignObject x={MILESTONES[1].coords.x - 5} y={MILESTONES[1].coords.y + 2} width="6" height="6"><Waves size="100%" color="#607d8b" className="opacity-60" /></foreignObject>
            <foreignObject x={MILESTONES[3].coords.x - 4} y={MILESTONES[3].coords.y - 6} width="6" height="6"><Waves size="100%" color="#607d8b" style={{ transform: 'rotate(45deg)' }} className="opacity-60" /></foreignObject>
            <foreignObject x={MILESTONES[4].coords.x + 2} y={MILESTONES[4].coords.y - 2} width="6" height="6"><Waves size="100%" color="#607d8b" style={{ transform: 'rotate(-30deg)' }} className="opacity-60" /></foreignObject>
            <foreignObject x={MILESTONES[5].coords.x - 6} y={MILESTONES[5].coords.y} width="6" height="6"><Waves size="100%" color="#607d8b" style={{ transform: 'rotate(90deg)' }} className="opacity-60" /></foreignObject>
            <foreignObject x={MILESTONES[6].coords.x - 10} y={MILESTONES[6].coords.y - 8} width="12" height="12"><Mountain size="100%" color="#4e342e" fill="#5d4037" className="opacity-90" /></foreignObject>
            <foreignObject x={MILESTONES[2].coords.x - 6} y={MILESTONES[2].coords.y + 5} width="6" height="6"><Mountain size="100%" color="#4e342e" className="opacity-60" /></foreignObject>
            <foreignObject x="15" y="60" width="10" height="10"><Mountain size="100%" color="#4e342e" className="opacity-40" /></foreignObject>
            <foreignObject x="25" y="65" width="8" height="8"><Mountain size="100%" color="#4e342e" className="opacity-40" /></foreignObject>
            <foreignObject x="10" y="30" width="8" height="8"><Mountain size="100%" color="#4e342e" className="opacity-30" /></foreignObject>
          </g>
        );

        return (
          <div className="flex flex-col w-full h-full gap-2">
            <div className="relative flex-1 bg-[#e0f2f1] rounded-xl overflow-hidden shadow-[inset_0_0_40px_rgba(0,0,0,0.15)] border-4 border-[#8d6e63]">
              <div className="absolute top-4 right-4 text-[#3e2723] font-serif text-xl md:text-3xl font-bold select-none pointer-events-none z-10 tracking-widest bg-[#fff8e1]/80 backdrop-blur-sm px-4 py-2 rounded-lg border border-[#8d6e63]/50 shadow-sm">ä¸­åœ‹å·¥è¾²ç´…è»é•·å¾è·¯ç·š</div>
              <div className="absolute bottom-4 left-4 bg-[#fff8e1]/90 backdrop-blur-md p-2 rounded-lg border border-[#8d6e63] shadow-lg z-10 text-[10px] md:text-xs select-none hidden md:block">
                <div className="font-bold text-[#3e2723] mb-1 border-b border-[#8d6e63]/30 pb-1">åœ–ä¾‹</div>
                <div className="grid grid-cols-1 gap-1.5">
                  <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-[#b71c1c] border border-[#fff8e1] shadow-sm"></div><span className="text-[#5d4037]">é•·å¾è·¯ç·šç¯€é»</span></div>
                  <div className="flex items-center gap-2"><div className="w-6 h-0.5 bg-[#b71c1c]"></div><span className="text-[#5d4037]">è¡Œè»è·¯ç·š</span></div>
                  <div className="flex items-center gap-2"><div className="w-3 h-3 bg-[#e57373] border border-[#c62828] opacity-80"></div><span className="text-[#5d4037]">é©å‘½æ ¹æ“šåœ°</span></div>
                  <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-[#78909c] border border-[#fff8e1]"></div><span className="text-[#5d4037]">ä¸»è¦åŸå¸‚</span></div>
                  <div className="flex items-center gap-2"><div className="w-3 h-1 bg-[#81d4fa]"></div><span className="text-[#5d4037]">ä¸»è¦æ²³æµ</span></div>
                </div>
              </div>
              <svg className="absolute inset-0 w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
                <defs>
                  <filter id="ruggedPath" x="-20%" y="-20%" width="140%" height="140%"><feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="3" result="noise" /><feDisplacementMap in="SourceGraphic" in2="noise" scale="1.5" /></filter>
                  <filter id="landShadow" x="-10%" y="-10%" width="120%" height="120%"><feDropShadow dx="0.5" dy="0.5" stdDeviation="0.5" floodColor="#3e2723" floodOpacity="0.3" /></filter>
                  <filter id="paperTexture"><feTurbulence type="fractalNoise" baseFrequency="0.4" numOctaves="4" result="noise"/><feDiffuseLighting in="noise" lightingColor="#fff8e1" surfaceScale="2"><feDistantLight azimuth="45" elevation="60"/></feDiffuseLighting><feComposite operator="in" in2="SourceGraphic"/><feBlend in="SourceGraphic" mode="multiply"/></filter>
                  <pattern id="seaPattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 0 10 Q 5 5 10 10 T 20 10" fill="none" stroke="#b2dfdb" strokeWidth="0.5" opacity="0.6"/></pattern>
                </defs>
                <rect width="100" height="100" fill="#e0f2f1" /><rect width="100" height="100" fill="url(#seaPattern)" opacity="0.4" />
                <g filter="url(#landShadow)"><path d="M 5 25 Q 15 20, 35 15 Q 45 12, 60 12 Q 75 10, 85 5 L 95 10 L 96 18 L 88 20 Q 80 22, 82 28 L 88 32 Q 90 38, 85 40 L 88 50 Q 90 55, 88 62 Q 85 70, 75 75 L 75 80 L 70 82 L 60 82 Q 50 85, 45 80 L 35 75 Q 30 70, 25 65 L 10 60 Q 5 50, 5 35 Z" fill="#fff9c4" stroke="#8d6e63" strokeWidth="0.3" /><path d="M 88 72 L 90 70 L 91 74 L 89 76 Z" fill="#fff9c4" stroke="#8d6e63" strokeWidth="0.3" /><path d="M 62 88 L 66 87 L 67 90 L 63 91 Z" fill="#fff9c4" stroke="#8d6e63" strokeWidth="0.3" /><path d="M 5 25 Q 15 20, 35 15 Q 45 12, 60 12 Q 75 10, 85 5 L 95 10 L 96 18 L 88 20 Q 80 22, 82 28 L 88 32 Q 90 38, 85 40 L 88 50 Q 90 55, 88 62 Q 85 70, 75 75 L 75 80 L 70 82 L 60 82 Q 50 85, 45 80 L 35 75 Q 30 70, 25 65 L 10 60 Q 5 50, 5 35 Z" fill="transparent" filter="url(#paperTexture)" opacity="0.5" /></g>
                <g className="pointer-events-none select-none">{PROVINCES.map((p, i) => (<text key={i} x={p.x} y={p.y} transform={`rotate(${p.r}, ${p.x}, ${p.y})`} fontSize="1.8" fill="#5d4037" opacity="0.7" textAnchor="middle" fontWeight="bold" style={{ letterSpacing: '0.5px', fontFamily: 'serif' }}>{p.name}</text>))}</g>
                <path d="M 68 68 Q 75 66 78 71 Q 75 76 70 74 Q 66 72 68 68 Z" fill="#ef9a9a" stroke="#c62828" strokeWidth="0.2" className="opacity-70 hover:opacity-90 transition-opacity duration-300" /><text x="73" y="72" fontSize="1.5" fill="#b71c1c" fontWeight="bold" textAnchor="middle" className="opacity-60" style={{ fontFamily: 'serif' }}>ä¸­å¤®è˜‡å€</text><path d="M 55 35 Q 60 33 62 38 Q 60 43 55 40 Q 53 38 55 35 Z" fill="#fff59d" stroke="#fbc02d" strokeWidth="0.2" className="opacity-70 hover:opacity-90 transition-opacity duration-300" /><text x="58" y="39" fontSize="1.5" fill="#f57f17" fontWeight="bold" textAnchor="middle" className="opacity-60" style={{ fontFamily: 'serif' }}>é™åŒ—æ ¹æ“šåœ°</text>
                <path d="M 35 42 Q 40 35, 45 35 L 50 30 L 60 28 L 65 35 L 65 42 L 75 40 L 82 28" fill="none" stroke="#81d4fa" strokeWidth="0.5" strokeLinecap="round" className="opacity-70" /><path d="M 25 50 Q 35 60, 40 55 Q 45 50, 48 55 L 55 60 L 65 55 L 75 60 L 88 58" fill="none" stroke="#81d4fa" strokeWidth="0.5" strokeLinecap="round" className="opacity-70" />
                <g>{CITIES.map((c, i) => (<g key={i} className="pointer-events-none"><circle cx={c.x} cy={c.y} r="0.4" fill="#607d8b" stroke="#eceff1" strokeWidth="0.1" /><text x={c.x + 1} y={c.y + 0.5} fontSize="1.2" fill="#455a64" className="opacity-80" style={{ fontFamily: 'serif' }}>{c.name}</text></g>))}</g>
                {renderTerrainDecorations()}
                <path d={generatePath()} fill="none" stroke="#795548" strokeWidth="0.4" strokeDasharray="1,1" className="opacity-50" filter="url(#ruggedPath)" /><path d={generateActivePath()} fill="none" stroke="#b71c1c" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round" className="drop-shadow-sm transition-all duration-1000 ease-in-out" filter="url(#ruggedPath)" />
                {MILESTONES.map((milestone, index) => { const isCurrent = index === currentStep; const isActive = index <= currentStep; const isHovered = hoveredIndex === index; const rVisual = isCurrent ? 2.5 : (isActive ? 1.5 : 1.2); return (<g key={milestone.id} onClick={() => onNodeClick(index)} onMouseEnter={() => setHoveredIndex(index)} onMouseLeave={() => setHoveredIndex(null)} className={`cursor-pointer transition-all duration-300 group ${isActive ? 'opacity-100' : 'opacity-60 hover:opacity-90'}`}><circle cx={milestone.coords.x} cy={milestone.coords.y} r="5" fill="transparent" /><circle cx={milestone.coords.x} cy={milestone.coords.y} r={rVisual} fill={isActive ? (isCurrent ? "#b71c1c" : "#d32f2f") : "#5d4037"} stroke={isActive ? "#fff" : "none"} strokeWidth={isCurrent ? 0.6 : 0.3} className={`transition-all duration-300 ease-out ${isCurrent ? 'drop-shadow-md' : ''}`} style={{ transformBox: 'fill-box', transformOrigin: 'center', transform: isHovered && !isCurrent ? 'scale(1.4)' : 'scale(1)' }} />{isCurrent && (<circle cx={milestone.coords.x} cy={milestone.coords.y} r="6" stroke="#b71c1c" strokeWidth="0.3" fill="none"><animate attributeName="r" from="2.5" to="8" dur="1.5s" repeatCount="indefinite" /><animate attributeName="opacity" from="0.6" to="0" dur="1.5s" repeatCount="indefinite" /></circle>)}<text x={milestone.coords.x} y={milestone.coords.y + 4} textAnchor="middle" className={`text-[2px] font-bold select-none pointer-events-none transition-all duration-300 ${isCurrent || isHovered ? 'fill-[#b71c1c] font-black scale-110' : 'fill-[#3e2723]'}`} style={{ textShadow: '0 1px 2px rgba(255,255,255,0.8)', fontFamily: 'serif' }}>{milestone.title}</text></g>); })}
                <g style={{ transform: `translate(${MILESTONES[currentStep].coords.x}px, ${MILESTONES[currentStep].coords.y}px)`, transition: 'transform 1s cubic-bezier(0.4, 0, 0.2, 1)' }} className="pointer-events-none"><foreignObject x="-3" y="-3" width="6" height="6" className="overflow-visible"><div className="w-full h-full flex items-center justify-center"><Star size="100%" fill="#ffd600" stroke="#b71c1c" strokeWidth={2} className="animate-pulse drop-shadow-lg" /></div></foreignObject></g>
              </svg>
            </div>
            <div className="flex items-center gap-2 bg-[#e0f2f1] p-1 rounded-xl border border-[#8d6e63]">
              <button onClick={() => onNodeClick(Math.max(0, currentStep - 1))} disabled={currentStep === 0} className="p-2 rounded-full hover:bg-[#b2dfdb] disabled:opacity-30 text-[#00695c] transition-colors"><ChevronLeft size={20} /></button>
              <div ref={timelineRef} className="h-16 bg-[#fff8e1] rounded-lg border border-[#d7ccc8] shadow-inner overflow-x-auto whitespace-nowrap p-2 flex items-center gap-4 flex-1 no-scrollbar scroll-smooth">
                {MILESTONES.map((m, idx) => { const isActive = idx === currentStep; const isPast = idx < currentStep; return (<div key={idx} onClick={() => onNodeClick(idx)} className={`inline-flex flex-col items-center justify-center gap-1 cursor-pointer p-1 rounded-lg transition-all duration-300 min-w-[80px] group ${isActive ? 'scale-110' : 'hover:bg-[#f9fbe7]/50'}`}><div className="relative flex items-center justify-center w-full h-5">{idx > 0 && (<div className={`absolute left-[-50%] right-[50%] h-0.5 top-2.5 -z-10 ${isActive || isPast ? 'bg-[#b71c1c]' : 'bg-[#d7ccc8]'}`}></div>)}{idx < MILESTONES.length - 1 && (<div className={`absolute left-[50%] right-[-50%] h-0.5 top-2.5 -z-10 ${isPast ? 'bg-[#b71c1c]' : 'bg-[#d7ccc8]'}`}></div>)}<div className={`w-3 h-3 rounded-full border-2 flex items-center justify-center transition-all ${isActive ? 'bg-[#b71c1c] border-[#ffd600] w-4 h-4 shadow-md' : (isPast ? 'bg-[#b71c1c] border-[#b71c1c]' : 'bg-[#efebe9] border-[#a1887f]')}`}>{isActive && <div className="w-1 h-1 bg-[#ffd600] rounded-full animate-pulse"></div>}</div></div><span className={`text-[10px] font-bold font-serif ${isActive ? 'text-[#b71c1c]' : 'text-[#5d4037] opacity-70'}`}>{m.title}</span></div>); })}
              </div>
              <button onClick={() => onNodeClick(Math.min(MILESTONES.length - 1, currentStep + 1))} disabled={currentStep === MILESTONES.length - 1} className="p-2 rounded-full hover:bg-[#b2dfdb] disabled:opacity-30 text-[#00695c] transition-colors"><ChevronRight size={20} /></button>
            </div>
          </div>
        );
      };

      // --- 7. ä¸»æ‡‰ç”¨çµ„ä»¶ (App) ---
      const App = () => {
        const [currentStep, setCurrentStep] = useState(0);
        const [isQuizOpen, setIsQuizOpen] = useState(false);
        const [isGameOpen, setIsGameOpen] = useState(false);
        const [showIntro, setShowIntro] = useState(true);
        const [activeTab, setActiveTab] = useState('history');
        const contentRef = useRef(null);
        const currentData = MILESTONES[currentStep];

        useEffect(() => { if (contentRef.current) contentRef.current.scrollTo({ top: 0, behavior: 'smooth' }); }, [currentStep, activeTab]);
        const handleNext = () => { if (currentStep < MILESTONES.length - 1) { setCurrentStep(prev => prev + 1); setActiveTab('history'); } };
        const handlePrev = () => { if (currentStep > 0) { setCurrentStep(prev => prev - 1); setActiveTab('history'); } };

        return (
          <div className="flex flex-col h-screen bg-[#e8e4d9] text-[#2c2420] font-sans overflow-hidden selection:bg-red-200 selection:text-red-900">
            <header className="bg-gradient-to-r from-[#8b1c1c] to-[#a02626] text-[#fff8e1] px-4 py-3 shadow-xl flex justify-between items-center z-30 relative shrink-0 border-b-[3px] border-[#d4af37]">
              <div className="flex items-center gap-3">
                <div className="bg-[#d4af37] text-[#8b1c1c] p-2 rounded-lg shadow-inner border border-[#fdd835] ring-2 ring-[#8b1c1c]/50"><Star size={20} fill="currentColor" className="animate-pulse" /></div>
                <div><h1 className="text-xl md:text-2xl font-bold tracking-[0.2em] leading-none font-serif text-[#fff8e1] drop-shadow-md">é•·å¾</h1><p className="text-[10px] text-[#ffecb3] font-medium tracking-wide opacity-90 mt-1">äºŒè¬äº”åƒé‡Œäº¤äº’å¼æ•™å­¸åœ°åœ–</p></div>
              </div>
              <div className="flex gap-3">
                <button onClick={() => setIsGameOpen(true)} className="group relative px-4 py-1.5 bg-[#fbc02d] hover:bg-[#ffeb3b] text-[#5d4037] rounded-full font-bold text-xs md:text-sm shadow-lg transition-all hover:-translate-y-0.5 border border-[#fdd835]"><span className="flex items-center gap-1.5 relative z-10"><Trophy size={14} /> ç”Ÿå­˜æŒ‘æˆ°</span><div className="absolute inset-0 bg-white/20 rounded-full blur opacity-0 group-hover:opacity-100 transition-opacity"></div></button>
                <button onClick={() => setShowIntro(true)} className="flex items-center gap-1.5 px-3 py-1.5 bg-black/20 hover:bg-black/30 rounded-full text-xs md:text-sm text-[#ffecb3] transition-colors border border-white/10"><Info size={14} /> æŒ‡å—</button>
              </div>
            </header>

            <div className="flex flex-1 flex-col md:flex-row overflow-hidden relative">
              <div className="w-full md:w-7/12 lg:w-2/3 h-[45vh] md:h-full relative z-0 bg-[#d7ccc8] shadow-[inset_-5px_0_15px_rgba(0,0,0,0.1)]">
                 <MapView currentStep={currentStep} onNodeClick={(idx) => { setCurrentStep(idx); setActiveTab('history'); }} />
                 <div className="absolute bottom-24 left-4 md:hidden bg-[#fff8e1]/95 backdrop-blur-sm px-4 py-2 rounded-full shadow-xl border border-[#d7ccc8] text-xs font-bold text-[#5d4037] flex items-center gap-2 z-10"><MapPin size={14} className="text-[#c62828]" /><span>{currentData.location}</span></div>
              </div>

              <div className="w-full md:w-5/12 lg:w-1/3 h-[55vh] md:h-full bg-paper flex flex-col shadow-2xl z-20 border-l border-[#bcaaa4] relative">
                <div className="flex items-center justify-between p-3 bg-[#e6e2d3] border-b border-[#d7ccc8] shrink-0 shadow-sm relative z-20">
                   <button onClick={handlePrev} disabled={currentStep === 0} className="flex items-center gap-1 pl-2 pr-3 py-2 rounded-lg text-[#5d4037] hover:bg-[#d7ccc8] disabled:opacity-30 disabled:cursor-not-allowed transition-all text-sm font-bold active:scale-95"><ChevronLeft size={18} /> ä¸Šä¸€ç«™</button>
                   <div className="flex flex-col items-center"><div className="text-[9px] uppercase tracking-widest text-[#8d6e63] font-bold mb-0.5">ç•¶å‰é€²åº¦</div><div className="bg-[#fff8e1] px-3 py-0.5 rounded border border-[#d7ccc8] shadow-inner flex items-center gap-1 text-sm font-bold font-mono text-[#3e2723]"><span className="text-[#c62828] text-base">{currentStep + 1}</span><span className="text-[#bdbdbd]">/</span><span>{MILESTONES.length}</span></div></div>
                   <button onClick={handleNext} disabled={currentStep === MILESTONES.length - 1} className="flex items-center gap-1 pl-3 pr-2 py-2 rounded-lg bg-[#b71c1c] text-[#fff8e1] hover:bg-[#c62828] disabled:bg-[#d7ccc8] disabled:text-[#a1887f] disabled:cursor-not-allowed transition-all shadow-md active:scale-95 text-sm font-bold">ä¸‹ä¸€ç«™ <ChevronRight size={18} /></button>
                </div>

                <div ref={contentRef} className="flex-1 overflow-y-auto scroll-smooth bg-paper relative pb-24">
                  <div className="px-6 pt-6 pb-2">
                     <div className="flex items-center justify-between mb-3"><div className="inline-flex items-center gap-1.5 px-2.5 py-1 rounded bg-[#efebe9] text-[#5d4037] border border-[#d7ccc8] text-xs font-bold uppercase tracking-wider shadow-sm"><MapPin size={12} className="text-[#c62828]" /> {currentData.location}</div><div className="text-xs text-[#8d6e63] font-serif font-bold tracking-wide italic border-b border-[#d7ccc8]">{currentData.date}</div></div>
                     <h2 className="text-3xl md:text-4xl font-black text-[#3e2723] leading-tight tracking-tight font-serif mb-4 drop-shadow-sm">{currentData.title}</h2>
                     <div className="inline-flex items-center gap-3 bg-white/60 px-3 py-1.5 rounded-r-xl border-l-4 border-[#ffb300] shadow-sm mb-2 backdrop-blur-sm"><div className={`p-1.5 rounded-full ${currentData.stat.icon === 'users' ? 'bg-blue-100 text-blue-800' : 'bg-amber-100 text-amber-800'}`}>{currentData.stat.icon === 'users' ? <Users size={14}/> : <Info size={14} />}</div><div className="flex flex-col leading-none"><span className="text-[9px] text-[#8d6e63] font-bold uppercase mb-0.5">{currentData.stat.label}</span><span className="text-sm font-bold text-[#3e2723]">{currentData.stat.value}</span></div></div>
                  </div>

                  <div className="sticky top-0 z-20 bg-paper/95 backdrop-blur-sm px-6 pt-2 pb-0 shadow-sm border-b border-[#d7ccc8]">
                      <div className="flex items-end gap-1">
                         {['history', 'figures', 'survival'].map((tab) => (
                            <button key={tab} onClick={() => setActiveTab(tab)} className={`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-t-lg text-xs md:text-sm font-bold transition-all duration-200 border-t border-x relative top-[1px] ${activeTab === tab ? 'bg-white border-[#d7ccc8] text-[#b71c1c] shadow-[0_-2px_5px_rgba(0,0,0,0.05)] z-10' : 'bg-[#f5f5f5] border-transparent text-[#9e9e9e] hover:bg-[#eeeeee] hover:text-[#757575]'}`}>
                               {tab === 'history' && <BookOpen size={14} />}{tab === 'figures' && <Users size={14} />}{tab === 'survival' && <Tent size={14} />}
                               {tab === 'history' ? 'æ­·å²' : tab === 'figures' ? 'äººç‰©' : 'é»æ»´'}
                            </button>
                         ))}
                      </div>
                  </div>

                  <div className="p-6 bg-white min-h-[400px] animate-fade-in-zoom">
                        {activeTab === 'history' && (<div className="space-y-6 animate-slide-up"><EventSchematic id={currentData.id} /><div className="relative pl-4 border-l-2 border-[#ffb300]"><h3 className="text-lg font-bold text-[#3e2723] mb-2 font-serif">äº‹ä»¶ç¶“é</h3><p className="text-[#5d4037] leading-relaxed text-justify text-sm md:text-base">{currentData.description}</p></div><div className="bg-[#fffde7] p-5 rounded-xl border border-[#fff59d] shadow-sm relative overflow-hidden"><Star className="absolute -right-2 -top-2 text-[#fff176] opacity-50" size={60} /><h3 className="flex items-center gap-2 font-bold text-[#c62828] text-base mb-2 font-serif relative z-10"><Flag size={16} /> æ­·å²æ„ç¾©</h3><p className="text-[#4e342e] leading-relaxed text-justify text-sm font-medium relative z-10">{currentData.significance}</p></div></div>)}
                        {activeTab === 'figures' && (<div className="space-y-4 animate-slide-up"><div className="bg-[#e3f2fd] p-4 rounded-xl border border-[#bbdefb] text-sm text-[#1565c0] flex gap-3 shadow-sm"><Info size={18} className="shrink-0 mt-0.5" /><p>æ­·å²æ˜¯ç”±äººæ°‘å‰µé€ çš„ï¼Œä½†è‹±é›„äººç‰©åœ¨é—œéµæ™‚åˆ»çš„æŠ‰æ“‡å¾€å¾€æ±ºå®šäº†æ­·å²çš„èµ°å‘ã€‚</p></div><div className="grid gap-4">{currentData.figures.map((person, idx) => (<div key={idx} className="bg-white p-5 rounded-xl border border-[#e0e0e0] shadow-sm hover:shadow-md hover:border-[#b0bec5] transition-all flex flex-col gap-2 group"><div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-10 h-10 rounded-full bg-[#eceff1] flex items-center justify-center text-[#546e7a] font-serif font-bold text-lg border border-[#cfd8dc] group-hover:bg-[#37474f] group-hover:text-white transition-colors">{person.name.charAt(0)}</div><h3 className="font-bold text-lg text-[#37474f]">{person.name}</h3></div><span className="text-[10px] font-bold bg-[#eceff1] text-[#455a64] px-2 py-1 rounded shadow-sm">{person.role}</span></div><p className="text-[#546e7a] text-sm leading-relaxed pl-[3.25rem]">{person.desc}</p></div>))}</div></div>)}
                        {activeTab === 'survival' && (<div className="space-y-6 animate-slide-up"><div className="bg-[#3e2723] rounded-xl shadow-lg border border-[#5d4037] overflow-hidden text-[#efebe9]"><div className="bg-gradient-to-r from-[#5d4037] to-[#4e342e] p-5 relative border-b border-[#6d4c41]"><div className="flex items-center gap-2 text-[#ffb74d] mb-1 opacity-90"><Tent size={16} /><span className="text-xs font-bold uppercase tracking-widest">è¡Œè»è¦‹è</span></div><h3 className="font-serif text-2xl font-bold tracking-wide">{currentData.survival.title}</h3><Flame className="absolute right-4 bottom-[-10px] text-[#ffcc80] opacity-10 w-24 h-24 rotate-12" /></div><div className="p-6 bg-[url('https://www.transparenttextures.com/patterns/dark-leather.png')]"><p className="text-[#d7ccc8] text-base leading-loose font-serif first-letter:text-3xl first-letter:font-bold first-letter:text-[#ffb74d] first-letter:mr-1">{currentData.survival.content}</p></div></div><div className="bg-[#fff8e1] p-4 rounded-xl border border-[#ffecb3] flex items-center gap-4 shadow-sm"><div className="w-12 h-12 rounded-full bg-white flex items-center justify-center text-[#ffa000] border border-[#ffecb3] shadow-inner"><Scroll size={24} /></div><div><div className="text-xs font-bold text-[#ffb300] uppercase mb-0.5">æ­·å²æ•¸æ“š</div><div className="text-sm font-medium text-[#5d4037]"><span className="font-bold text-[#3e2723] mr-2">{currentData.stat.label}:</span>{currentData.stat.value}</div></div></div></div>)}
                  </div>
                </div>

                <div className="absolute bottom-0 left-0 right-0 p-4 pt-8 bg-gradient-to-t from-white via-white to-transparent z-30 pointer-events-none flex justify-center">
                   <button onClick={() => setIsQuizOpen(true)} className="pointer-events-auto w-full max-w-sm py-3 bg-gradient-to-r from-[#ffa000] to-[#ff6f00] hover:from-[#ffb300] hover:to-[#ff8f00] text-[#3e2723] font-bold rounded-xl shadow-[0_4px_10px_rgba(255,111,0,0.3)] hover:shadow-[0_6px_15px_rgba(255,111,0,0.4)] transform hover:-translate-y-1 active:translate-y-0 transition-all flex items-center justify-center gap-2 border border-[#ffe082]"><HelpCircle size={20} /> <span>éš¨å ‚çŸ¥è­˜å•ç­”</span></button>
                </div>
              </div>
            </div>

            <QuizModal quizzes={currentData.quizzes} isOpen={isQuizOpen} onClose={() => setIsQuizOpen(false)} />
            <SurvivalGameModal milestones={MILESTONES} isOpen={isGameOpen} onClose={() => setIsGameOpen(false)} />

            {showIntro && (
              <div className="fixed inset-0 bg-[#263238]/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in-zoom">
                <div className="bg-[#fdfbf7] rounded-xl max-w-2xl w-full shadow-2xl overflow-hidden border-4 border-[#3e2723] flex flex-col max-h-[90vh] relative">
                  <div className="absolute top-4 right-4 border-2 border-[#c62828] text-[#c62828] rounded px-2 py-1 text-xs font-bold uppercase -rotate-12 opacity-80 mix-blend-multiply pointer-events-none">TOP SECRET</div>
                  <div className="bg-[#8b1c1c] p-6 text-[#fff8e1] flex justify-between items-start shrink-0 relative overflow-hidden shadow-md"><div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div><div className="relative z-10"><h2 className="text-3xl font-bold mb-1 tracking-widest font-serif">é•·å¾æª”æ¡ˆ</h2><p className="text-[#ffcdd2] text-sm font-medium tracking-wide">äº’å‹•å¼æ­·å²æ•™å­¸è¼”åŠ©ç³»çµ±</p></div><button onClick={() => setShowIntro(false)} className="relative z-10 text-[#ffcdd2] hover:text-white transition-colors bg-white/10 hover:bg-white/20 p-2 rounded-full"><X size={20} /></button></div>
                  <div className="p-8 space-y-6 overflow-y-auto bg-paper">
                    <p className="text-[#4e342e] text-lg font-serif italic text-center border-b border-[#d7ccc8] pb-4">"ç´…è»ä¸æ€•é å¾é›£ï¼Œè¬æ°´åƒå±±åªç­‰é–’ã€‚"</p>
                    <div className="grid md:grid-cols-3 gap-4">
                      <div className="bg-white p-4 rounded-lg border border-[#d7ccc8] shadow-sm hover:border-[#bcaaa4] transition-all text-center"><BookOpen size={28} className="mx-auto mb-2 text-[#8b1c1c]" /><h3 className="font-bold text-[#3e2723] mb-1">å¤šç¶­æ•˜äº‹</h3><p className="text-xs text-[#5d4037]">æˆ°ç•¥åœ°åœ– x æˆ°è¡“åœ–è§£</p></div>
                      <div className="bg-white p-4 rounded-lg border border-[#d7ccc8] shadow-sm hover:border-[#bcaaa4] transition-all text-center"><Users size={28} className="mx-auto mb-2 text-[#0d47a1]" /><h3 className="font-bold text-[#3e2723] mb-1">äººç‰©èšç„¦</h3><p className="text-xs text-[#5d4037]">é‚„åŸé®®æ´»æ­·å²ç¾¤åƒ</p></div>
                      <div className="bg-white p-4 rounded-lg border border-[#d7ccc8] shadow-sm hover:border-[#bcaaa4] transition-all text-center"><Tent size={28} className="mx-auto mb-2 text-[#f57f17]" /><h3 className="font-bold text-[#3e2723] mb-1">ç”Ÿå­˜é«”é©—</h3><p className="text-xs text-[#5d4037]">æ•¸æ“šæ¨¡æ“¬è¡Œè»æŒ‘æˆ°</p></div>
                    </div>
                    <div className="group bg-[#fff8e1] p-5 rounded-xl border border-[#ffe082] flex items-center gap-4 cursor-pointer hover:shadow-md transition-all relative overflow-hidden" onClick={() => {setShowIntro(false); setIsGameOpen(true);}}><div className="bg-[#fbc02d] text-[#3e2723] p-3 rounded-full shrink-0 shadow-sm group-hover:scale-110 transition-transform z-10"><Trophy size={24} /></div><div className="flex-1 z-10"><div className="flex items-center gap-2 mb-1"><h4 className="font-bold text-[#3e2723] text-lg">æŒ‘æˆ°æ¨¡å¼ï¼šçªåœ</h4><span className="bg-[#c62828] text-white text-[10px] px-1.5 py-0.5 rounded font-bold">HARD</span></div><p className="text-xs text-[#5d4037]">æ‰®æ¼”æŒ‡æ®å®˜ï¼Œåœ¨è³‡æºåŒ±ä¹ä¸­åšå‡ºè‰±é›£æŠ‰æ“‡ã€‚èƒ½å¦å¸¶é ˜éƒ¨éšŠåˆ°é”é™åŒ—ï¼Ÿ</p></div><ChevronRight className="text-[#fbc02d] group-hover:translate-x-1 transition-transform z-10" /></div>
                  </div>
                  <div className="p-6 bg-[#efebe9] border-t border-[#d7ccc8] shrink-0"><button onClick={() => setShowIntro(false)} className="w-full py-3.5 bg-[#3e2723] text-[#fff8e1] font-bold rounded-lg hover:bg-[#4e342e] transition-all shadow-lg transform active:scale-[0.99] flex items-center justify-center gap-2 text-base tracking-wider">é–‹å•Ÿæª”æ¡ˆ <ChevronRight size={16} /></button></div>
                </div>
              </div>
            )}
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
